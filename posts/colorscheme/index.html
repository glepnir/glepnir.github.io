<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=cache-control content="max-age=0"><meta http-equiv=cache-control content="no-cache"><meta http-equiv=expires content="0"><meta http-equiv=expires content="Tue, 01 Jan 1980 1:00:00 GMT"><meta http-equiv=pragma content="no-cache"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png }><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#1b1b1b"><meta name=description content="The Best Theme Isn't the Prettiest—It's the One You Forget Exists"><title>The Best Theme Isn't the Prettiest—It's the One You Forget Exists | glepnir's blog</title><style>:root{--background:#ffffff}@media(prefers-color-scheme:dark){:root{--background:#1b1b1b}}html{background-color:var(--background)}body{background-color:var(--background)}</style><link rel=stylesheet type=text/css href=/style.min.0e9c0bb0a7de7a330263937778a4d7c0d0c6be7f327c69a0223c9f2fd31e00d5.css media=all><link rel=stylesheet href=/css/katex.min.css integrity="sha512-0u6F0kGPTUgsoq8qPa0w03CxxmEz3qYfl9eTPJL8DK4QJE9/XL1SSoiXoYhvDXCrBMBVWtaAIWsWoCg1TkJybA==" crossorigin=anonymous></head><body><nav><ul class=menu><li><a tabindex=-1 class=menu-link href=/><u>H</u>ome</a></li><li><a tabindex=-1 class=menu-link href=/tags><u>T</u>ags</a></li></ul></nav><div id=single-header><h1>The Best Theme Isn&rsquo;t the Prettiest—It&rsquo;s the One You Forget Exists</h1><div id=single-meta><span class=datesub>Dec 24, 2025</span>
<span id=tags>&nbsp;&nbsp;
<span><a href=https://www.functor.me/tags/neovim/>#neovim</a>
</span>&nbsp; <span><a href=https://www.functor.me/tags/color-science/>#color-science</a>
</span>&nbsp; <span><a href=https://www.functor.me/tags/vision-research/>#vision-research</a>
</span>&nbsp; <span><a href=https://www.functor.me/tags/oklab/>#oklab</a>
</span>&nbsp;</span></div></div><aside class="hidden lg:block toc" id=tableOfContentContainer><nav id=TableOfContents><ul><li><a href=#part-1-your-color-picker-is-probably-lying-to-you>Part 1: Your Color Picker is Probably Lying to You</a><ul><li><a href=#enter-oklab-a-color-space-that-actually-makes-sense>Enter Oklab: A Color Space That Actually Makes Sense</a></li></ul></li><li><a href=#part-2-what-actually-needs-to-be-colorful>Part 2: What Actually Needs to be Colorful?</a><ul><li><a href=#my-new-three-tier-system>My New Three-Tier System</a></li></ul></li><li><a href=#part-3-brightness-is-everything-seriously>Part 3: Brightness is Everything (Seriously)</a><ul><li><a href=#building-a-brightness-hierarchy-that-actually-works>Building a Brightness Hierarchy That Actually Works</a></li><li><a href=#the-complete-brightness-system>The Complete Brightness System</a></li></ul></li><li><a href=#part-4-the-fatigue-factor>Part 4: The Fatigue Factor</a></li><li><a href=#part-5-what-colors-mean>Part 5: What Colors &ldquo;Mean&rdquo;</a></li><li><a href=#putting-it-all-together>Putting It All Together</a></li><li><a href=#does-it-actually-work>Does It Actually Work?</a></li><li><a href=#a-quick-reality-check>A Quick Reality Check</a></li><li><a href=#references--further-reading>References & Further Reading</a></li></ul></nav></aside><main><p>For years, I was stuck in this cycle: find something that looks decent, tweak HSL values until it &ldquo;feels right,&rdquo; use it for a few weeks, then get that creeping eye strain. Suddenly colors that looked fine before would start to irritate me. Back to the drawing board.</p><p>I must have done this dozens of times. Each round felt more arbitrary than the last—just moving sliders around hoping something would click. Honestly, it was getting ridiculous. Why couldn&rsquo;t I just find something that worked and stick with it?</p><p>Then one night, while adjusting my umpteenth orange hue, it hit me: people have been studying vision for decades. There&rsquo;s actual science about how we see color, what causes eye strain, how to make things readable. Maybe instead of guessing, I could actually, you know, use that science.</p><p>So I did. And it turns out, building a theme from first principles works way better than tweaking hex codes.</p><h2 id=part-1-your-color-picker-is-probably-lying-to-you>Part 1: Your Color Picker is Probably Lying to You</h2><p>Here&rsquo;s the thing no one tells you: RGB and HSL are kind of broken for designing themes. They make sense to computers but not to human eyes. In RGB, the &ldquo;distance&rdquo; between colors has nothing to do with how different they actually look. HSL is slightly better, but still weird—changing saturation can make some colors get much brighter while others barely change.</p><p>It&rsquo;s like trying to measure temperature with a ruler. You&rsquo;re using the wrong tool for the job.</p><h3 id=enter-oklab-a-color-space-that-actually-makes-sense>Enter Oklab: A Color Space That Actually Makes Sense</h3><p>After digging around, I found something called Oklab. It&rsquo;s a &ldquo;perceptually uniform&rdquo; color space, which is a fancy way of saying: if you move a color 10 units in Oklab, it looks about 10 units different to your eyes. No surprises.</p><p>The math goes something like this:</p><p><strong>Step 1: Oklab → LMS (how your eye&rsquo;s cones respond)</strong></p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>l</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>m</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>s</mi></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.3963</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.2158</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>0.1056</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>0.0639</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>0.0895</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1.2915</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>L</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>a</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">
\begin{bmatrix} l \\ m \\ s \end{bmatrix} = \begin{bmatrix} 1 &amp; 0.3963 &amp; 0.2158 \\ 1 &amp; -0.1056 &amp; -0.0639 \\ 1 &amp; -0.0895 &amp; -1.2915 \end{bmatrix} \begin{bmatrix} L \\ a \\ b \end{bmatrix}
</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:3.6em;vertical-align:-1.55em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M403 1759V84H666V0H319V1759v0 1759h347v-84H403zm0 0V0H319V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal" style=margin-right:.01968em>l</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">m</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">s</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mclose><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M347 1759V0H0V84H263V1759v0 1759H0v84H347zm0 0V0H263V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:3.6em;vertical-align:-1.55em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M403 1759V84H666V0H319V1759v0 1759h347v-84H403zm0 0V0H319V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0.3963</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>−</span><span class=mord>0.1056</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>−</span><span class=mord>0.0895</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0.2158</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>−</span><span class=mord>0.0639</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>−</span><span class=mord>1.2915</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mclose><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M347 1759V0H0V84H263V1759v0 1759H0v84H347zm0 0V0H263V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M403 1759V84H666V0H319V1759v0 1759h347v-84H403zm0 0V0H319V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">L</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">a</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">b</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mclose><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M347 1759V0H0V84H263V1759v0 1759H0v84H347zm0 0V0H263V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span></span></span></span></span><p><strong>Step 2: Inverse cube root</strong></p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mtext>LMS</mtext><mtext>linear</mtext></msub><mo>=</mo><mo stretchy="false">[</mo><msup><mi>l</mi><mn>3</mn></msup><mo separator="true">,</mo><msup><mi>m</mi><mn>3</mn></msup><mo separator="true">,</mo><msup><mi>s</mi><mn>3</mn></msup><msup><mo stretchy="false">]</mo><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">
\text{LMS}_{\text{linear}} = [l^3, m^3, s^3]^T
</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord text"><span class=mord>LMS</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">linear</span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.1413em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8641em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8641em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8641em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class=mclose><span class=mclose>]</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8913em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.13889em>T</span></span></span></span></span></span></span></span></span></span></span></span><p><strong>Step 3: LMS → Linear RGB</strong></p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>R</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>G</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>B</mi></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>4.0767</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>3.3077</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.2310</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1.2684</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2.6098</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>0.3413</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>0.0042</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>0.7034</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1.7076</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>l</mi><mn>3</mn></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>m</mi><mn>3</mn></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>s</mi><mn>3</mn></msup></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">
\begin{bmatrix} R \\ G \\ B \end{bmatrix} = \begin{bmatrix} 4.0767 &amp; -3.3077 &amp; 0.2310 \\ -1.2684 &amp; 2.6098 &amp; -0.3413 \\ -0.0042 &amp; -0.7034 &amp; 1.7076 \end{bmatrix} \begin{bmatrix} l^3 \\ m^3 \\ s^3 \end{bmatrix}
</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:3.6em;vertical-align:-1.55em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M403 1759V84H666V0H319V1759v0 1759h347v-84H403zm0 0V0H319V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal" style=margin-right:.00773em>R</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">G</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mclose><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M347 1759V0H0V84H263V1759v0 1759H0v84H347zm0 0V0H263V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:3.6em;vertical-align:-1.55em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M403 1759V84H666V0H319V1759v0 1759h347v-84H403zm0 0V0H319V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>4.0767</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>−</span><span class=mord>1.2684</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>−</span><span class=mord>0.0042</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>−</span><span class=mord>3.3077</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>2.6098</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>−</span><span class=mord>0.7034</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0.2310</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>−</span><span class=mord>0.3413</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1.7076</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mclose><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M347 1759V0H0V84H263V1759v0 1759H0v84H347zm0 0V0H263V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M403 1759V84H666V0H319V1759v0 1759h347v-84H403zm0 0V0H319V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mclose><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M347 1759V0H0V84H263V1759v0 1759H0v84H347zm0 0V0H263V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span></span></span></span></span><p><strong>Step 4: Gamma correction (sRGB)</strong></p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>C</mi><mtext>sRGB</mtext></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>12.92</mn><mo>×</mo><msub><mi>C</mi><mtext>linear</mtext></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>if </mtext><msub><mi>C</mi><mtext>linear</mtext></msub><mo>≤</mo><mn>0.0031308</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1.055</mn><mo>×</mo><msubsup><mi>C</mi><mtext>linear</mtext><mrow><mn>1</mn><mi mathvariant="normal">/</mi><mn>2.4</mn></mrow></msubsup><mo>−</mo><mn>0.055</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>otherwise</mtext></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
C_{\text{sRGB}} = \begin{cases} 12.92 \times C_{\text{linear}} &amp; \text{if } C_{\text{linear}} \leq 0.0031308 \\ 1.055 \times C_{\text{linear}}^{1/2.4} - 0.055 &amp; \text{otherwise} \end{cases}
</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3283em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">sRGB</span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:3em;vertical-align:-1.25em></span><span class=minner><span class="mopen delimcenter" style=top:0><span class="delimsizing size4">{</span></span><span class=mord><span class=mtable><span class=col-align-l><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.7084em><span style=top:-3.7452em><span class=pstrut style=height:3.0448em></span><span class=mord><span class=mord>12.92</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">linear</span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span><span style=top:-2.2684em><span class=pstrut style=height:3.0448em></span><span class=mord><span class=mord>1.055</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.0448em><span style=top:-2.3987em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">linear</span></span></span></span></span><span style=top:-3.2198em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1/2.4</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.3013em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span><span class=mord>0.055</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.2084em><span></span></span></span></span></span><span class=arraycolsep style=width:1em></span><span class=col-align-l><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.7084em><span style=top:-3.7452em><span class=pstrut style=height:3.0448em></span><span class=mord><span class="mord text"><span class=mord>if </span></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">linear</span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2778em></span><span class=mord>0.0031308</span></span></span><span style=top:-2.2684em><span class=pstrut style=height:3.0448em></span><span class=mord><span class="mord text"><span class=mord>otherwise</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.2084em><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><p>Yeah, that looks intimidating. But here&rsquo;s the Lua code that makes it usable:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>oklab_to_linear_rgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>-- Oklab to LMS</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>l</span> <span class=o>=</span> <span class=n>L</span> <span class=o>+</span> <span class=mf>0.3963377774</span> <span class=o>*</span> <span class=n>a</span> <span class=o>+</span> <span class=mf>0.2158037573</span> <span class=o>*</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>m</span> <span class=o>=</span> <span class=n>L</span> <span class=o>-</span> <span class=mf>0.1055613458</span> <span class=o>*</span> <span class=n>a</span> <span class=o>-</span> <span class=mf>0.0638541728</span> <span class=o>*</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>s</span> <span class=o>=</span> <span class=n>L</span> <span class=o>-</span> <span class=mf>0.0894841775</span> <span class=o>*</span> <span class=n>a</span> <span class=o>-</span> <span class=mf>1.2914855480</span> <span class=o>*</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>-- Inverse cube root</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>l3</span><span class=p>,</span> <span class=n>m3</span><span class=p>,</span> <span class=n>s3</span> <span class=o>=</span> <span class=n>l</span> <span class=o>*</span> <span class=n>l</span> <span class=o>*</span> <span class=n>l</span><span class=p>,</span> <span class=n>m</span> <span class=o>*</span> <span class=n>m</span> <span class=o>*</span> <span class=n>m</span><span class=p>,</span> <span class=n>s</span> <span class=o>*</span> <span class=n>s</span> <span class=o>*</span> <span class=n>s</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>-- LMS to linear RGB</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>r</span> <span class=o>=</span> <span class=mf>4.0767416621</span> <span class=o>*</span> <span class=n>l3</span> <span class=o>-</span> <span class=mf>3.3077115913</span> <span class=o>*</span> <span class=n>m3</span> <span class=o>+</span> <span class=mf>0.2309699292</span> <span class=o>*</span> <span class=n>s3</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>g</span> <span class=o>=</span> <span class=o>-</span><span class=mf>1.2684380046</span> <span class=o>*</span> <span class=n>l3</span> <span class=o>+</span> <span class=mf>2.6097574011</span> <span class=o>*</span> <span class=n>m3</span> <span class=o>-</span> <span class=mf>0.3413193965</span> <span class=o>*</span> <span class=n>s3</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>b_out</span> <span class=o>=</span> <span class=o>-</span><span class=mf>0.0041960863</span> <span class=o>*</span> <span class=n>l3</span> <span class=o>-</span> <span class=mf>0.7034186147</span> <span class=o>*</span> <span class=n>m3</span> <span class=o>+</span> <span class=mf>1.7076147010</span> <span class=o>*</span> <span class=n>s3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>return</span> <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b_out</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>linear_to_srgb_component</span><span class=p>(</span><span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>-- Gamma correction</span>
</span></span><span class=line><span class=cl>  <span class=kr>if</span> <span class=n>c</span> <span class=o>&lt;=</span> <span class=mf>0.0031308</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=n>c</span> <span class=o>*</span> <span class=mf>12.92</span>
</span></span><span class=line><span class=cl>  <span class=kr>else</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=mf>1.055</span> <span class=o>*</span> <span class=p>(</span><span class=n>c</span> <span class=o>^</span> <span class=p>(</span><span class=mi>1</span> <span class=o>/</span> <span class=mf>2.4</span><span class=p>))</span> <span class=o>-</span> <span class=mf>0.055</span>
</span></span><span class=line><span class=cl>  <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b_comp</span> <span class=o>=</span> <span class=n>oklab_to_linear_rgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>r</span> <span class=o>=</span> <span class=n>linear_to_srgb_component</span><span class=p>(</span><span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>g</span> <span class=o>=</span> <span class=n>linear_to_srgb_component</span><span class=p>(</span><span class=n>g</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>b_comp</span> <span class=o>=</span> <span class=n>linear_to_srgb_component</span><span class=p>(</span><span class=n>b_comp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>-- Clamp and convert to hex</span>
</span></span><span class=line><span class=cl>  <span class=n>r</span> <span class=o>=</span> <span class=n>math.floor</span><span class=p>(</span><span class=n>math.max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>math.min</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>r</span><span class=p>))</span> <span class=o>*</span> <span class=mi>255</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>g</span> <span class=o>=</span> <span class=n>math.floor</span><span class=p>(</span><span class=n>math.max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>math.min</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>g</span><span class=p>))</span> <span class=o>*</span> <span class=mi>255</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>b_comp</span> <span class=o>=</span> <span class=n>math.floor</span><span class=p>(</span><span class=n>math.max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>math.min</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>b_comp</span><span class=p>))</span> <span class=o>*</span> <span class=mi>255</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>return</span> <span class=n>string.format</span><span class=p>(</span><span class=s1>&#39;#%02x%02x%02x&#39;</span><span class=p>,</span> <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b_comp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><p>The cool part? Now instead of this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=c1>-- Random hex code I found somewhere</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>orange</span> <span class=o>=</span> <span class=s2>&#34;#c5895b&#34;</span>
</span></span></code></pre></div><p>I can do this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=c1>-- &#34;I want a color that&#39;s 68% bright, slightly warm&#34;</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>orange</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.68</span><span class=p>,</span> <span class=mf>0.055</span><span class=p>,</span> <span class=mf>0.065</span><span class=p>)</span>
</span></span></code></pre></div><p>That first number is brightness (0-1). The next two control hue and saturation. Want it brighter? Increase the first number. Want it more orange? Adjust the ratio. It&rsquo;s predictable in a way hex codes never were.</p><h2 id=part-2-what-actually-needs-to-be-colorful>Part 2: What Actually Needs to be Colorful?</h2><p>Here&rsquo;s where I made my first big mistake. I used to color everything—variables, operators, you name it. Turns out, that&rsquo;s probably wrong.</p><p>I found this 2018 study with 390 programming beginners. The surprising finding? Syntax highlighting doesn&rsquo;t really help with understanding code. But wait—it <em>does</em> help when it emphasizes <strong>structural elements</strong> rather than coloring everything equally.</p><p>The takeaway: <strong>Highlight structure, not noise.</strong></p><p>Then I read Ivan Tonsky&rsquo;s article where he points out that most of your code is variables and function calls. If you highlight all of those, you&rsquo;re coloring like 75% of the screen. No wonder everything looks busy!</p><p>His suggestion made so much sense: keep variables and operators neutral (same color as regular text). Only use bright colors for the stuff that actually matters.</p><h3 id=my-new-three-tier-system>My New Three-Tier System</h3><p>This research led me to a much simpler approach:</p><ol><li><p><strong>Bright colors</strong> for the important bits:</p><ul><li>Control flow (if, for, while, return)</li><li>Function definitions</li><li>Type declarations</li></ul></li><li><p><strong>Regular text color</strong> for the rest:</p><ul><li>Variable names</li><li>Operators</li><li>Function parameters</li></ul></li><li><p><strong>Dimmed colors</strong> for secondary stuff:</p><ul><li>Comments</li><li>Delimiters</li></ul></li></ol><p>The result is subtle but effective. The code&rsquo;s structure jumps out at you, but most of the screen stays calm and readable.</p><h2 id=part-3-brightness-is-everything-seriously>Part 3: Brightness is Everything (Seriously)</h2><p>This was my biggest &ldquo;aha&rdquo; moment. I used to spend hours debating whether keywords should be orange or yellow. Turns out, I was asking the wrong question.</p><p>Human eyes are way more sensitive to <strong>brightness differences</strong> than to <strong>color differences</strong>. Like, 5-10 times more sensitive. There&rsquo;s actual science behind this called the &ldquo;Contrast Sensitivity Function.&rdquo;</p><p>So the real question isn&rsquo;t &ldquo;what color should this be?&rdquo; It&rsquo;s &ldquo;how bright should this be compared to that?&rdquo;</p><h3 id=building-a-brightness-hierarchy-that-actually-works>Building a Brightness Hierarchy That Actually Works</h3><p>I started with some basic constraints:</p><ul><li><strong>Background:</strong> L=0.24 (dark enough to be comfortable at night)</li><li><strong>Regular text:</strong> L=0.74 (great contrast, meets accessibility standards)</li></ul><p>From the research, I knew structure was most important, errors needed attention, and data was secondary. So I made three brightness levels:</p><ol><li><strong>Brightest (L=0.68):</strong> Structure elements (keywords, functions, types)</li><li><strong>Middle (L=0.66):</strong> Errors and warnings</li><li><strong>Dimmest (L=0.64):</strong> Data (strings, numbers, constants)</li></ol><p>The math checks out for contrast ratios:</p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mtext>CR</mtext><mo stretchy="false">(</mo><msub><mi>L</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>L</mi><mtext>bg</mtext></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><mn>0.68</mn><mo>+</mo><mn>0.05</mn></mrow><mrow><mn>0.24</mn><mo>+</mo><mn>0.05</mn></mrow></mfrac><mo>=</mo><mn>5.52</mn><mo>:</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mtext>CR</mtext><mo stretchy="false">(</mo><msub><mi>L</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>L</mi><mtext>bg</mtext></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><mn>0.66</mn><mo>+</mo><mn>0.05</mn></mrow><mrow><mn>0.24</mn><mo>+</mo><mn>0.05</mn></mrow></mfrac><mo>=</mo><mn>5.03</mn><mo>:</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mtext>CR</mtext><mo stretchy="false">(</mo><msub><mi>L</mi><mn>3</mn></msub><mo separator="true">,</mo><msub><mi>L</mi><mtext>bg</mtext></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><mn>0.64</mn><mo>+</mo><mn>0.05</mn></mrow><mrow><mn>0.24</mn><mo>+</mo><mn>0.05</mn></mrow></mfrac><mo>=</mo><mn>4.76</mn><mo>:</mo><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\text{CR}(L_1, L_{\text{bg}}) &amp;= \frac{0.68 + 0.05}{0.24 + 0.05} = 5.52:1 \\
\text{CR}(L_2, L_{\text{bg}}) &amp;= \frac{0.66 + 0.05}{0.24 + 0.05} = 5.03:1 \\
\text{CR}(L_3, L_{\text{bg}}) &amp;= \frac{0.64 + 0.05}{0.24 + 0.05} = 4.76:1
\end{aligned}
</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:7.1723em;vertical-align:-3.3362em></span><span class=mord><span class=mtable><span class=col-align-r><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:3.8362em><span style=top:-5.8362em><span class=pstrut style=height:3.3214em></span><span class=mord><span class="mord text"><span class=mord>CR</span></span><span class=mopen>(</span><span class=mord><span class="mord mathnormal">L</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">L</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">bg</span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span><span style=top:-3.4454em><span class=pstrut style=height:3.3214em></span><span class=mord><span class="mord text"><span class=mord>CR</span></span><span class=mopen>(</span><span class=mord><span class="mord mathnormal">L</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">L</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">bg</span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span><span style=top:-1.0546em><span class=pstrut style=height:3.3214em></span><span class=mord><span class="mord text"><span class=mord>CR</span></span><span class=mopen>(</span><span class=mord><span class="mord mathnormal">L</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">L</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">bg</span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:3.3362em><span></span></span></span></span></span><span class=col-align-l><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:3.8362em><span style=top:-5.8362em><span class=pstrut style=height:3.3214em></span><span class=mord><span class=mord></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3214em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0.24</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord>0.05</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0.68</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord>0.05</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.7693em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class=mord>5.52</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>:</span><span class=mspace style=margin-right:.2778em></span><span class=mord>1</span></span></span><span style=top:-3.4454em><span class=pstrut style=height:3.3214em></span><span class=mord><span class=mord></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3214em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0.24</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord>0.05</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0.66</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord>0.05</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.7693em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class=mord>5.03</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>:</span><span class=mspace style=margin-right:.2778em></span><span class=mord>1</span></span></span><span style=top:-1.0546em><span class=pstrut style=height:3.3214em></span><span class=mord><span class=mord></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.3214em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0.24</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord>0.05</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0.64</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord>0.05</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.7693em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class=mord>4.76</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>:</span><span class=mspace style=margin-right:.2778em></span><span class=mord>1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:3.3362em><span></span></span></span></span></span></span></span></span></span></span></span><p>All three meet WCAG AA standards, and the brightness differences (ΔL=0.02) are noticeable without being jarring.</p><p>Here&rsquo;s what&rsquo;s cool: in my old themes, errors were the same brightness as strings. No wonder I&rsquo;d miss them! Now errors stand out just enough to catch my attention without looking like an alarm went off.</p><h3 id=the-complete-brightness-system>The Complete Brightness System</h3><table><thead><tr><th>Level</th><th>Brightness</th><th>Use For</th><th>Why It Works</th></tr></thead><tbody><tr><td>1</td><td>L=0.68</td><td>Keywords, Functions, Types</td><td>Guides your eye to the code&rsquo;s structure</td></tr><tr><td>2</td><td>L=0.66</td><td>Errors, Warnings</td><td>Noticeable but not overwhelming</td></tr><tr><td>3</td><td>L=0.64</td><td>Strings, Numbers, Constants</td><td>Stays in the background</td></tr><tr><td>-</td><td>L=0.24</td><td>Background</td><td>Easy on the eyes</td></tr><tr><td>-</td><td>L=0.74</td><td>Regular text</td><td>Maximum readability</td></tr></tbody></table><h2 id=part-4-the-fatigue-factor>Part 4: The Fatigue Factor</h2><p>Here&rsquo;s something I never considered: different colors actually cause different amounts of eye strain. Red wavelengths are the worst—they make your pupils constrict more, which gets tiring. Yellow is the easiest on your eyes.</p><p>There&rsquo;s research (they measure pupil response and everything) that shows for comfortable long sessions, you want to keep colors muted:</p><ul><li>Average saturation around 0.08</li><li>Red saturation under 0.09</li><li>Yellow/green under 0.10</li></ul><p>In Oklab, saturation is simple:</p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>s</mi><mo>=</mo><msqrt><mrow><msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding="application/x-tex">
s = \sqrt{a^2 + b^2}
</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal">s</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.24em;vertical-align:-.1777em></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.0623em><span class=svg-align style=top:-3.2em><span class=pstrut style=height:3.2em></span><span class=mord style=padding-left:1em><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7401em><span style=top:-2.989em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7401em><span style=top:-2.989em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style=top:-3.0223em><span class=pstrut style=height:3.2em></span><span class=hide-tail style=min-width:1.02em;height:1.28em><svg width="400em" height="1.28em" viewBox="0 0 4e5 1296" preserveAspectRatio="xMinYMin slice"><path d="M263 681c.7.0 18 39.7 52 119s68.167 158.7 102.5 238c34.3 79.3 51.8 119.3 52.5 120 340-704.7 510.7-1060.3 512-1067 4.7-7.3 11-11 19-11H4e4v40H1012.3L741 687c-38.7 80.7-84 175-136 283s-89.167 185.3-111.5 232c-22.3 46.7-33.8 70.3-34.5 71-4.7 4.7-12.3 7-23 7s-12-1-12-1-109-253-109-253c-72.7-168-109.3-252-110-252-10.7 8-22 16.7-34 26-22 17.3-33.3 26-34 26s-26-26-26-26 76-59 76-59 76-60 76-60zM1001 80h4e5v40h-4e5z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.1777em><span></span></span></span></span></span></span></span></span></span><p>So I made sure all my colors stayed in the safe zone:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=c1>-- Orange for keywords: √(0.055² + 0.065²) ≈ 0.085</span>
</span></span><span class=line><span class=cl><span class=n>colors.orange</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.68</span><span class=p>,</span> <span class=mf>0.055</span><span class=p>,</span> <span class=mf>0.065</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Red for errors: √(0.08² + 0.04²) ≈ 0.089 (just under 0.09)</span>
</span></span><span class=line><span class=cl><span class=n>colors.red</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.66</span><span class=p>,</span> <span class=mf>0.08</span><span class=p>,</span> <span class=mf>0.04</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Yellow for types: √(0.02² + 0.08²) ≈ 0.082</span>
</span></span><span class=line><span class=cl><span class=n>colors.yellow</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.68</span><span class=p>,</span> <span class=mf>0.02</span><span class=p>,</span> <span class=mf>0.08</span><span class=p>)</span>
</span></span></code></pre></div><p>No more wondering why my eyes hurt after a marathon coding session.</p><h2 id=part-5-what-colors-mean>Part 5: What Colors &ldquo;Mean&rdquo;</h2><p>Colors aren&rsquo;t just pretty—they carry associations. Research shows we tend to agree on what colors mean:</p><ul><li><strong>Red</strong> → Error, Danger, Stop</li><li><strong>Orange</strong> → Action, Warning, Warm</li><li><strong>Yellow</strong> → Important, Attention</li><li><strong>Green</strong> → Success, Natural, Content</li><li><strong>Blue</strong> → Logic, Stability, Cool</li><li><strong>Cyan</strong> → Technical, Meta</li><li><strong>Violet</strong> → Abstract, Special</li></ul><p>This gave me a logical way to assign colors:</p><table><thead><tr><th>Code Element</th><th>Why This Color</th><th>Oklab Values</th></tr></thead><tbody><tr><td>Keywords</td><td>Action → Orange</td><td>(0.68, 0.055, 0.065)</td></tr><tr><td>Functions</td><td>Logic → Blue</td><td>(0.68, -0.02, -0.06)</td></tr><tr><td>Types</td><td>Important → Yellow</td><td>(0.68, 0.02, 0.08)</td></tr><tr><td>Errors</td><td>Danger → Red</td><td>(0.66, 0.08, 0.04)</td></tr><tr><td>Strings</td><td>Content → Green</td><td>(0.64, -0.05, 0.06)</td></tr><tr><td>Constants</td><td>Technical → Cyan</td><td>(0.64, -0.055, -0.01)</td></tr><tr><td>Numbers</td><td>Abstract → Violet</td><td>(0.64, 0.05, -0.04)</td></tr></tbody></table><h2 id=putting-it-all-together>Putting It All Together</h2><p>Here&rsquo;s the final palette. Every value comes from those principles, not random guesses:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>colors</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Background and text</span>
</span></span><span class=line><span class=cl><span class=n>colors.bg</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.24</span><span class=p>,</span> <span class=mf>0.001</span><span class=p>,</span> <span class=mf>0.006</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>colors.fg</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.74</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.008</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Layer 1: Structure (brightest)</span>
</span></span><span class=line><span class=cl><span class=n>colors.orange</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.68</span><span class=p>,</span> <span class=mf>0.055</span><span class=p>,</span> <span class=mf>0.065</span><span class=p>)</span>  <span class=c1>-- Keywords</span>
</span></span><span class=line><span class=cl><span class=n>colors.blue</span>   <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.68</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.02</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.06</span><span class=p>)</span>  <span class=c1>-- Functions</span>
</span></span><span class=line><span class=cl><span class=n>colors.yellow</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.68</span><span class=p>,</span> <span class=mf>0.02</span><span class=p>,</span>  <span class=mf>0.08</span><span class=p>)</span>   <span class=c1>-- Types</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Layer 2: Diagnostics</span>
</span></span><span class=line><span class=cl><span class=n>colors.red</span>    <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.66</span><span class=p>,</span> <span class=mf>0.08</span><span class=p>,</span>  <span class=mf>0.04</span><span class=p>)</span>   <span class=c1>-- Errors</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Layer 3: Data</span>
</span></span><span class=line><span class=cl><span class=n>colors.green</span>  <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.64</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.05</span><span class=p>,</span> <span class=mf>0.06</span><span class=p>)</span>   <span class=c1>-- Strings</span>
</span></span><span class=line><span class=cl><span class=n>colors.cyan</span>   <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.64</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.055</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.01</span><span class=p>)</span> <span class=c1>-- Constants</span>
</span></span><span class=line><span class=cl><span class=n>colors.violet</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.64</span><span class=p>,</span> <span class=mf>0.05</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.04</span><span class=p>)</span>   <span class=c1>-- Numbers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>return</span> <span class=n>colors</span>
</span></span></code></pre></div><p>And the highlight groups:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=c1>-- Important stuff (bright)</span>
</span></span><span class=line><span class=cl><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_hl</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;Keyword&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=n>fg</span> <span class=o>=</span> <span class=n>colors.orange</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_hl</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;Function&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=n>fg</span> <span class=o>=</span> <span class=n>colors.blue</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_hl</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;Type&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=n>fg</span> <span class=o>=</span> <span class=n>colors.yellow</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Less important (dimmer)</span>
</span></span><span class=line><span class=cl><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_hl</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;String&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=n>fg</span> <span class=o>=</span> <span class=n>colors.green</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_hl</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;Constant&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=n>fg</span> <span class=o>=</span> <span class=n>colors.cyan</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_hl</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;Number&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=n>fg</span> <span class=o>=</span> <span class=n>colors.violet</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Neutral (same as regular text)</span>
</span></span><span class=line><span class=cl><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_hl</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;Identifier&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=n>fg</span> <span class=o>=</span> <span class=n>colors.fg</span> <span class=p>})</span>  <span class=c1>-- Variables</span>
</span></span><span class=line><span class=cl><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_hl</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;Operator&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=n>fg</span> <span class=o>=</span> <span class=n>colors.fg</span> <span class=p>})</span>    <span class=c1>-- =, +, -, etc.</span>
</span></span></code></pre></div><h2 id=does-it-actually-work>Does It Actually Work?</h2><p><p class=imgp><img loading=lazy src=/images/colorscheme.png alt=Retina></p></p><p>Don&rsquo;t doubt it, this is still neovim 😏. I&rsquo;ve been using this theme (I call it <strong>Retina</strong>) for two months now. Here&rsquo;s what I&rsquo;ve noticed:</p><ul><li><strong>My eyes don&rsquo;t get tired anymore.</strong> I can code for hours without that strained feeling.</li><li><strong>Errors actually stand out.</strong> That slight brightness bump makes all the difference.</li><li><strong>I can see the code&rsquo;s structure immediately.</strong> My eyes naturally follow the bright keywords.</li><li><strong>It&rsquo;s&mldr; quiet.</strong> With most variables staying neutral, there&rsquo;s way less visual noise.</li></ul><h2 id=a-quick-reality-check>A Quick Reality Check</h2><p>Look, vision is personal. This works for me, but your eyes might be different. Things that matter:</p><ul><li><strong>Your age</strong> (older eyes often need more contrast)</li><li><strong>Your monitor</strong> (OLED vs LCD, different calibrations)</li><li><strong>Your environment</strong> (dark room vs bright office)</li><li><strong>Your color vision</strong> (about 8% of men see colors differently)</li></ul><p>The beauty of this approach is you can adjust the <em>parameters</em> instead of guessing:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=c1>-- Need more contrast? Bump up the brightness:</span>
</span></span><span class=line><span class=cl><span class=n>colors.orange</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.70</span><span class=p>,</span> <span class=mf>0.055</span><span class=p>,</span> <span class=mf>0.065</span><span class=p>)</span>  <span class=c1>-- Was 0.68</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Colors too strong? Tone down the saturation:</span>
</span></span><span class=line><span class=cl><span class=n>colors.orange</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.68</span><span class=p>,</span> <span class=mf>0.044</span><span class=p>,</span> <span class=mf>0.052</span><span class=p>)</span>  <span class=c1>-- 20% less saturation</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Want different hues? Adjust the a,b ratio:</span>
</span></span><span class=line><span class=cl><span class=n>colors.orange</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.68</span><span class=p>,</span> <span class=mf>0.050</span><span class=p>,</span> <span class=mf>0.070</span><span class=p>)</span>  <span class=c1>-- More yellow</span>
</span></span></code></pre></div><p>You&rsquo;re tuning a system, not just picking random colors.</p><p>The best theme really is the one you forget you&rsquo;re using. It just gets out of your way and lets you focus on the code.</p><hr><h2 id=references--further-reading>References & Further Reading</h2><ol><li><strong>Oklab color space:</strong> <a href=https://bottosson.github.io/posts/oklab/ target=_blank rel="noreferrer nofollow">https://bottosson.github.io/posts/oklab/</a></li><li><strong>Contrast Sensitivity Function:</strong> Barten, P. G. J. (1999)</li><li><strong>Color Appearance Models:</strong> Fairchild, M. D. (2013)</li><li><strong>Visual Fatigue Study:</strong> Fan et al. (2024)</li><li><strong>Color Semantics:</strong> Schloss, K. B. (2024)</li><li><strong>Vision and Aging:</strong> Owsley, C. (2016)</li><li><strong>Syntax Highlighting Research:</strong> Hannebauer et al. (2018)</li><li><strong>&ldquo;Syntax Highlighting is a Waste of Time&rdquo;:</strong> <a href=https://tonsky.me/blog/syntax-highlighting/ target=_blank rel="noreferrer nofollow">https://tonsky.me/blog/syntax-highlighting/</a></li></ol><hr><p><em>You can find the complete theme <a href=https://github.com/glepnir/nvim/blob/main/colors/retina.lua target=_blank rel="noreferrer nofollow">on GitHub</a>. Use it, tweak it, or just steal the ideas for your own theme. Either way, I hope it helps you break out of the endless theme-tweaking cycle.</em></p></main><div class=sponsor><a href=https://github.com/sponsors/glepnir target=_blank rel="noopener noreferrer" class=sponsor-btn>❤️ Sponsor</a></div><section class=comments><script src=https://giscus.app/client.js data-repo=glepnir/glepnir.github.io data-repo-id data-category=General data-category-id data-mapping=pathname data-strict=0 data-reactions-enabled data-emit-metadata data-input-position data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script></section><br><footer class=site-footer><p class=footer-meta>© 2025 glepnir ·
<a href=https://github.com/glepnir>GitHub</a> ·
<a href=https://reddit.com/u/glephunter>Reddit</a> ·
<a href=https://www.functor.me/index.xml>RSS</a></p><script defer>document.addEventListener("keydown",function(e){if(document.activeElement.isContentEditable)return!1;if(document.activeElement.tagName=="INPUT")return!1;if(e.altKey||e.ctrlKey||e.shiftKey)return!1;var t=e.key;if(t==="h")e.preventDefault(),e.stopPropagation(),window.location.href="/";else if(t==="t")e.preventDefault(),e.stopPropagation(),window.location.href=`https://${location.hostname}/tags`;else if(t==="i"){e.preventDefault(),e.stopPropagation();const t=document.querySelectorAll("input");for(let e=0;e<t.length;e++)if(t[e].offsetParent!==null){t[e].selectionStart=t[e].selectionEnd=t[e].value.length,t[e].focus();break}}return!1})</script><script defer>function throttle(e,t){var n=Date.now();return function(){var s=Date.now();n+t-s<0&&(e(),n=s)}}function scrollHandler(){const e=Array.from(document.querySelectorAll("body h2, body h3"));function t(){for(var n,s,o,i=window.pageYOffset||document.documentElement.scrollTop,t=0;t<e.length;t++)s=e[t].getAttribute("id"),n=document.querySelector('nav ul li a[href="#'+s+'"]'),n&&n.classList.remove("active-toc");for(t=e.length-1;t>=0;t--)if(o=e[t].offsetTop,i>o-75&&(s=e[t].getAttribute("id"),n=document.querySelector('nav ul li a[href="#'+s+'"]'),n)){n.classList.add("active-toc");break}}window.addEventListener("scroll",throttle(t,200))}setTimeout(scrollHandler,100)</script><script defer>function getTextContentRecursively(e){let t="";if(e.nodeType===Node.TEXT_NODE)return e.textContent||"";for(const n of e.childNodes)t+=getTextContentRecursively(n);return t}function addCopyButtonToCodeBlocks(){const e=document.querySelectorAll('code[class^="language-"]:not(.output):not([class*="language-console"])');e.forEach(e=>{const t=document.createElement("button");t.classList.add("copy-code-button"),t.innerHTML="copy",t.addEventListener("click",()=>{const n=getTextContentRecursively(e);navigator.clipboard.writeText(n),t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},1500)}),e.parentNode.before(t)})}setTimeout(function(){addCopyButtonToCodeBlocks()},100)</script><script>window.store={"https://www.functor.me/":{title:"glepnir's blog",tags:[],content:"",url:"https://www.functor.me/"},"https://www.functor.me/posts/":{title:"Posts",tags:[],content:"",url:"https://www.functor.me/posts/"},"https://www.functor.me/posts/thought_fp/":{title:"When Loops Become Math: How Functional Thinking Changed My C++",tags:[],content:`Last week, I was staring at two pieces of code a friend had sent me, asking which one I preferred. They looked like this:
// Version A double calculate_mean(const vector&lt;double&gt;&amp; data) { double sum = 0.0; for (const auto&amp; x : data) { sum += x; } return sum / data.size(); } // Version B double calculate_stddev(const vector&lt;double&gt;&amp; data) { double sum = 0.0; double mean = calculate_mean(data); for (const auto&amp; x : data) { sum += (x - mean) * (x - mean); } return sqrt(sum / data.size()); } I looked at them for a solid five seconds before it hit me: these two loops were fundamentally the same mathematical pattern! But in the code, that pattern was buried under for loops and accumulation variables.
Seeing with Math Eyes In math, we&rsquo;d write these calculations as:
mean=1n∑i=1nxi \\text{mean} = \\frac{1}{n} \\sum_{i=1}^n x_i mean=n1​i=1∑n​xi​stddev=1n∑i=1n(xi−μ)2 \\text{stddev} = \\sqrt{\\frac{1}{n} \\sum_{i=1}^n (x_i - \\mu)^2} stddev=n1​i=1∑n​(xi​−μ)2​See that $\\sum$ symbol? That&rsquo;s our abstraction point. In functional programming, this is called a fold (or reduce), defined as:
fold(f,z,[x1,x2,...,xn])=f(f(f(z,x1),x2),...,xn) \\text{fold}(f, z, [x_1, x_2, ..., x_n]) = f(f(f(z, x_1), x_2), ..., x_n) fold(f,z,[x1​,x2​,...,xn​])=f(f(f(z,x1​),x2​),...,xn​)Looking at my code with this new perspective:
template&lt;typename T, typename BinaryOp&gt; T fold(const vector&lt;T&gt;&amp; vec, T init, BinaryOp op) { T result = init; for (const auto&amp; x : vec) { result = op(result, x); } return result; } Now both calculations become:
double mean = fold(data, 0.0, plus&lt;double&gt;{}) / data.size(); double variance = fold(data, 0.0, [mean](double acc, double x) { return acc + (x - mean) * (x - mean); }) / data.size(); The Real Breakthrough: Seeing Deeper Patterns I started noticing this pattern everywhere. Take this convex hull algorithm I&rsquo;d written:
vector&lt;Point&gt; find_convex_hull(const vector&lt;Point&gt;&amp; points) { vector&lt;Point&gt; hull; for (size_t i = 0; i &lt; points.size(); ++i) { for (size_t j = 0; j &lt; points.size(); ++j) { if (i == j) continue; bool all_on_same_side = true; for (size_t k = 0; k &lt; points.size(); ++k) { if (k == i || k == j) continue; if (!is_on_same_side(points[i], points[j], points[k])) { all_on_same_side = false; break; } } if (all_on_same_side) { hull.push_back(points[i]); hull.push_back(points[j]); } } } return remove_duplicates(hull); } Three nested loops! But with functional thinking, I saw predicate logic:
A point pair (i,j) belongs to the convex hull boundary if and only if all other points are on the same side of the line segment (i,j).
Mathematically: (i,j)∈hull ⟺ ∀k≠i,j:same_side(i,j,k) (i,j) \\in \\text{hull} \\iff \\forall k \\neq i,j : \\text{same\\_side}(i,j,k) (i,j)∈hull⟺∀k=i,j:same_side(i,j,k)In C++, this becomes:
vector&lt;Point&gt; find_convex_hull_fp(const vector&lt;Point&gt;&amp; points) { auto pairs = cartesian_product(points, points); auto is_hull_edge = [&amp;](const pair&lt;Point, Point&gt;&amp; edge) { return all_of(points.begin(), points.end(), [&amp;](const Point&amp; p) { return &amp;p == &amp;edge.first || &amp;p == &amp;edge.second || is_on_same_side(edge.first, edge.second, p); }); }; return filter(pairs, is_hull_edge) | transform([](auto&amp;&amp; p) { return vector{p.first, p.second}; }) | flatten() | unique(); } Why This Matters: You Can Actually Prove Things Here&rsquo;s the cool part: functional code is easier to reason about.
With the original code, proving correctness meant:
Tracking three loop variables Understanding when the break happens Verifying when hull gets updated With the functional version:
cartesian_product generates all point pairs (obvious) is_hull_edge is a direct translation of the mathematical definition The composition uses standard, well-understood operations I can even write tests that verify mathematical properties:
// Convex hull property: all points should be inside the hull TEST(ConvexHull, AllPointsInsideHull) { auto points = generate_random_points(100); auto hull = find_convex_hull_fp(points); for (const auto&amp; p : points) { ASSERT_TRUE(is_point_inside_convex_polygon(p, hull)); } } Category Theory Sneaks In Recently, I was writing a config parser with multiple operations that could fail:
optional&lt;int&gt; parse_timeout(const string&amp; str); optional&lt;string&gt; parse_hostname(const string&amp; str); optional&lt;Config&gt; create_config(int timeout, const string&amp; host); The traditional way:
optional&lt;Config&gt; parse_config(const string&amp; timeout_str, const string&amp; host_str) { auto timeout = parse_timeout(timeout_str); if (!timeout) return nullopt; auto host = parse_hostname(host_str); if (!host) return nullopt; return create_config(*timeout, *host); } The functional way uses a pattern (some people call it a monad, but I just call it useful):
template&lt;typename T, typename Func&gt; auto and_then(const optional&lt;T&gt;&amp; opt, Func f) -&gt; decltype(f(opt.value())) { if (!opt) return decltype(f(opt.value()))(); return f(*opt); } optional&lt;Config&gt; parse_config_fp(const string&amp; timeout_str, const string&amp; host_str) { return and_then(parse_timeout(timeout_str), [&amp;](int timeout) { return and_then(parse_hostname(host_str), [&amp;](const string&amp; host) { return create_config(timeout, host); }); }); } Mathematically, this is composition in the Kleisli category: f:A→M(B),g:B→M(C)g∘Kf:A→M(C) f: A \\to M(B), \\quad g: B \\to M(C) \\\\ g \\circ_K f: A \\to M(C) f:A→M(B),g:B→M(C)g∘K​f:A→M(C)Performance? Actually Better People say functional code is slow. Modern C++ compilers are smart:
// Hand-written &#34;optimized&#34; version double sum_squares(const vector&lt;double&gt;&amp; data) { double sum = 0.0; for (const auto&amp; x : data) { sum += x * x; } return sum; } // Functional version double sum_squares_fp(const vector&lt;double&gt;&amp; data) { return fold(data, 0.0, [](double acc, double x) { return acc + x * x; }); } With -O3, GCC generates identical assembly for both. The functional version is actually safer—no loop variables, no bounds checking worries.
My New Toolkit Here&rsquo;s what functional thinking added to my C++ toolbox:
map/filter/reduce - The basics for working with collections Function composition - compose(f, g)(x) = f(g(x)) Currying - curry(f)(a)(b) = f(a, b) Lazy evaluation - Using generator or ranges::view Like currying for configuration:
auto create_server = curry([](int port, const string&amp; host, Config config) { return Server{port, host, config}; }); auto create_local_server = create_server(8080, &#34;localhost&#34;); auto server = create_local_server(config); The Mindset Shift Functional programming taught me something important: code is math, and the compiler is my proof assistant.
Before: I wrote loops thinking &ldquo;do this repeatedly&rdquo;. Now: I write fold thinking &ldquo;apply this associative operation&rdquo;.
Before: I wrote conditionals thinking &ldquo;if this, then that&rdquo;. Now: I write filter thinking &ldquo;select elements satisfying this predicate&rdquo;.
This mindset lets me write code that&rsquo;s easier to prove correct. Last week I found a bug and mentally traced it:
Given: filter(is_even, [1,2,3,4]) = [2,4] Given: map(square, [2,4]) = [4,16] Given: fold(add, 0, [4,16]) = 20 Therefore: sum of squares of even numbers = 20 Writing it down like that was the proof.
Functional C++ in the Real World This is how I write production code now:
// HTTP request processing pipeline auto handle_request = compose( validate_request, authenticate, parse_body&lt;Order&gt;, process_order, create_response ); // Or with ranges auto valid_orders = requests | views::filter(is_valid_order) | views::transform(parse_order) | views::filter([](const Order&amp; o) { return o.total &gt; 100.0; }) | views::transform(apply_discount) | ranges::to&lt;vector&gt;(); This isn&rsquo;t &ldquo;functional C++&quot;—it&rsquo;s just C++. But it&rsquo;s C++ written with functional thinking.
Finally When I started seeing loops through mathematical eyes, they stopped being loops and became instances of algebraic structures. That perspective lets me write code that&rsquo;s cleaner, more correct, and honestly more fun to write.
Maybe that&rsquo;s the end goal of programming: code stops being instructions and becomes executable mathematics.
`,url:"https://www.functor.me/posts/thought_fp/"},"https://www.functor.me/tags/color-science/":{title:"Color-Science",tags:[],content:"",url:"https://www.functor.me/tags/color-science/"},"https://www.functor.me/tags/neovim/":{title:"Neovim",tags:[],content:"",url:"https://www.functor.me/tags/neovim/"},"https://www.functor.me/tags/oklab/":{title:"Oklab",tags:[],content:"",url:"https://www.functor.me/tags/oklab/"},"https://www.functor.me/tags/":{title:"Tags",tags:[],content:"",url:"https://www.functor.me/tags/"},"https://www.functor.me/posts/colorscheme/":{title:"The Best Theme Isn't the Prettiest—It's the One You Forget Exists",tags:["neovim","color-science","vision-research","oklab"],content:`For years, I was stuck in this cycle: find something that looks decent, tweak HSL values until it &ldquo;feels right,&rdquo; use it for a few weeks, then get that creeping eye strain. Suddenly colors that looked fine before would start to irritate me. Back to the drawing board.
I must have done this dozens of times. Each round felt more arbitrary than the last—just moving sliders around hoping something would click. Honestly, it was getting ridiculous. Why couldn&rsquo;t I just find something that worked and stick with it?
Then one night, while adjusting my umpteenth orange hue, it hit me: people have been studying vision for decades. There&rsquo;s actual science about how we see color, what causes eye strain, how to make things readable. Maybe instead of guessing, I could actually, you know, use that science.
So I did. And it turns out, building a theme from first principles works way better than tweaking hex codes.
Part 1: Your Color Picker is Probably Lying to You Here&rsquo;s the thing no one tells you: RGB and HSL are kind of broken for designing themes. They make sense to computers but not to human eyes. In RGB, the &ldquo;distance&rdquo; between colors has nothing to do with how different they actually look. HSL is slightly better, but still weird—changing saturation can make some colors get much brighter while others barely change.
It&rsquo;s like trying to measure temperature with a ruler. You&rsquo;re using the wrong tool for the job.
Enter Oklab: A Color Space That Actually Makes Sense After digging around, I found something called Oklab. It&rsquo;s a &ldquo;perceptually uniform&rdquo; color space, which is a fancy way of saying: if you move a color 10 units in Oklab, it looks about 10 units different to your eyes. No surprises.
The math goes something like this:
Step 1: Oklab → LMS (how your eye&rsquo;s cones respond) [lms]=[10.39630.21581−0.1056−0.06391−0.0895−1.2915][Lab] \\begin{bmatrix} l \\\\ m \\\\ s \\end{bmatrix} = \\begin{bmatrix} 1 &amp; 0.3963 &amp; 0.2158 \\\\ 1 &amp; -0.1056 &amp; -0.0639 \\\\ 1 &amp; -0.0895 &amp; -1.2915 \\end{bmatrix} \\begin{bmatrix} L \\\\ a \\\\ b \\end{bmatrix} ​lms​​=​111​0.3963−0.1056−0.0895​0.2158−0.0639−1.2915​​​Lab​​Step 2: Inverse cube root LMSlinear=[l3,m3,s3]T \\text{LMS}_{\\text{linear}} = [l^3, m^3, s^3]^T LMSlinear​=[l3,m3,s3]TStep 3: LMS → Linear RGB [RGB]=[4.0767−3.30770.2310−1.26842.6098−0.3413−0.0042−0.70341.7076][l3m3s3] \\begin{bmatrix} R \\\\ G \\\\ B \\end{bmatrix} = \\begin{bmatrix} 4.0767 &amp; -3.3077 &amp; 0.2310 \\\\ -1.2684 &amp; 2.6098 &amp; -0.3413 \\\\ -0.0042 &amp; -0.7034 &amp; 1.7076 \\end{bmatrix} \\begin{bmatrix} l^3 \\\\ m^3 \\\\ s^3 \\end{bmatrix} ​RGB​​=​4.0767−1.2684−0.0042​−3.30772.6098−0.7034​0.2310−0.34131.7076​​​l3m3s3​​Step 4: Gamma correction (sRGB) CsRGB={12.92×Clinearif Clinear≤0.00313081.055×Clinear1/2.4−0.055otherwise C_{\\text{sRGB}} = \\begin{cases} 12.92 \\times C_{\\text{linear}} &amp; \\text{if } C_{\\text{linear}} \\leq 0.0031308 \\\\ 1.055 \\times C_{\\text{linear}}^{1/2.4} - 0.055 &amp; \\text{otherwise} \\end{cases} CsRGB​={12.92×Clinear​1.055×Clinear1/2.4​−0.055​if Clinear​≤0.0031308otherwise​Yeah, that looks intimidating. But here&rsquo;s the Lua code that makes it usable:
local function oklab_to_linear_rgb(L, a, b) -- Oklab to LMS local l = L + 0.3963377774 * a + 0.2158037573 * b local m = L - 0.1055613458 * a - 0.0638541728 * b local s = L - 0.0894841775 * a - 1.2914855480 * b -- Inverse cube root local l3, m3, s3 = l * l * l, m * m * m, s * s * s -- LMS to linear RGB local r = 4.0767416621 * l3 - 3.3077115913 * m3 + 0.2309699292 * s3 local g = -1.2684380046 * l3 + 2.6097574011 * m3 - 0.3413193965 * s3 local b_out = -0.0041960863 * l3 - 0.7034186147 * m3 + 1.7076147010 * s3 return r, g, b_out end local function linear_to_srgb_component(c) -- Gamma correction if c &lt;= 0.0031308 then return c * 12.92 else return 1.055 * (c ^ (1 / 2.4)) - 0.055 end end local function oklab_to_srgb(L, a, b) local r, g, b_comp = oklab_to_linear_rgb(L, a, b) r = linear_to_srgb_component(r) g = linear_to_srgb_component(g) b_comp = linear_to_srgb_component(b_comp) -- Clamp and convert to hex r = math.floor(math.max(0, math.min(1, r)) * 255 + 0.5) g = math.floor(math.max(0, math.min(1, g)) * 255 + 0.5) b_comp = math.floor(math.max(0, math.min(1, b_comp)) * 255 + 0.5) return string.format(&#39;#%02x%02x%02x&#39;, r, g, b_comp) end The cool part? Now instead of this:
-- Random hex code I found somewhere local orange = &#34;#c5895b&#34; I can do this:
-- &#34;I want a color that&#39;s 68% bright, slightly warm&#34; local orange = oklab_to_srgb(0.68, 0.055, 0.065) That first number is brightness (0-1). The next two control hue and saturation. Want it brighter? Increase the first number. Want it more orange? Adjust the ratio. It&rsquo;s predictable in a way hex codes never were.
Part 2: What Actually Needs to be Colorful? Here&rsquo;s where I made my first big mistake. I used to color everything—variables, operators, you name it. Turns out, that&rsquo;s probably wrong.
I found this 2018 study with 390 programming beginners. The surprising finding? Syntax highlighting doesn&rsquo;t really help with understanding code. But wait—it does help when it emphasizes structural elements rather than coloring everything equally.
The takeaway: Highlight structure, not noise.
Then I read Ivan Tonsky&rsquo;s article where he points out that most of your code is variables and function calls. If you highlight all of those, you&rsquo;re coloring like 75% of the screen. No wonder everything looks busy!
His suggestion made so much sense: keep variables and operators neutral (same color as regular text). Only use bright colors for the stuff that actually matters.
My New Three-Tier System This research led me to a much simpler approach:
Bright colors for the important bits:
Control flow (if, for, while, return) Function definitions Type declarations Regular text color for the rest:
Variable names Operators Function parameters Dimmed colors for secondary stuff:
Comments Delimiters The result is subtle but effective. The code&rsquo;s structure jumps out at you, but most of the screen stays calm and readable.
Part 3: Brightness is Everything (Seriously) This was my biggest &ldquo;aha&rdquo; moment. I used to spend hours debating whether keywords should be orange or yellow. Turns out, I was asking the wrong question.
Human eyes are way more sensitive to brightness differences than to color differences. Like, 5-10 times more sensitive. There&rsquo;s actual science behind this called the &ldquo;Contrast Sensitivity Function.&rdquo;
So the real question isn&rsquo;t &ldquo;what color should this be?&rdquo; It&rsquo;s &ldquo;how bright should this be compared to that?&rdquo;
Building a Brightness Hierarchy That Actually Works I started with some basic constraints:
Background: L=0.24 (dark enough to be comfortable at night) Regular text: L=0.74 (great contrast, meets accessibility standards) From the research, I knew structure was most important, errors needed attention, and data was secondary. So I made three brightness levels:
Brightest (L=0.68): Structure elements (keywords, functions, types) Middle (L=0.66): Errors and warnings Dimmest (L=0.64): Data (strings, numbers, constants) The math checks out for contrast ratios: CR(L1,Lbg)=0.68+0.050.24+0.05=5.52:1CR(L2,Lbg)=0.66+0.050.24+0.05=5.03:1CR(L3,Lbg)=0.64+0.050.24+0.05=4.76:1 \\begin{aligned} \\text{CR}(L_1, L_{\\text{bg}}) &amp;= \\frac{0.68 + 0.05}{0.24 + 0.05} = 5.52:1 \\\\ \\text{CR}(L_2, L_{\\text{bg}}) &amp;= \\frac{0.66 + 0.05}{0.24 + 0.05} = 5.03:1 \\\\ \\text{CR}(L_3, L_{\\text{bg}}) &amp;= \\frac{0.64 + 0.05}{0.24 + 0.05} = 4.76:1 \\end{aligned} CR(L1​,Lbg​)CR(L2​,Lbg​)CR(L3​,Lbg​)​=0.24+0.050.68+0.05​=5.52:1=0.24+0.050.66+0.05​=5.03:1=0.24+0.050.64+0.05​=4.76:1​All three meet WCAG AA standards, and the brightness differences (ΔL=0.02) are noticeable without being jarring.
Here&rsquo;s what&rsquo;s cool: in my old themes, errors were the same brightness as strings. No wonder I&rsquo;d miss them! Now errors stand out just enough to catch my attention without looking like an alarm went off.
The Complete Brightness System Level Brightness Use For Why It Works 1 L=0.68 Keywords, Functions, Types Guides your eye to the code&rsquo;s structure 2 L=0.66 Errors, Warnings Noticeable but not overwhelming 3 L=0.64 Strings, Numbers, Constants Stays in the background - L=0.24 Background Easy on the eyes - L=0.74 Regular text Maximum readability Part 4: The Fatigue Factor Here&rsquo;s something I never considered: different colors actually cause different amounts of eye strain. Red wavelengths are the worst—they make your pupils constrict more, which gets tiring. Yellow is the easiest on your eyes.
There&rsquo;s research (they measure pupil response and everything) that shows for comfortable long sessions, you want to keep colors muted:
Average saturation around 0.08 Red saturation under 0.09 Yellow/green under 0.10 In Oklab, saturation is simple: s=a2+b2 s = \\sqrt{a^2 + b^2} s=a2+b2​So I made sure all my colors stayed in the safe zone:
-- Orange for keywords: √(0.055² + 0.065²) ≈ 0.085 colors.orange = oklab_to_srgb(0.68, 0.055, 0.065) -- Red for errors: √(0.08² + 0.04²) ≈ 0.089 (just under 0.09) colors.red = oklab_to_srgb(0.66, 0.08, 0.04) -- Yellow for types: √(0.02² + 0.08²) ≈ 0.082 colors.yellow = oklab_to_srgb(0.68, 0.02, 0.08) No more wondering why my eyes hurt after a marathon coding session.
Part 5: What Colors &ldquo;Mean&rdquo; Colors aren&rsquo;t just pretty—they carry associations. Research shows we tend to agree on what colors mean:
Red → Error, Danger, Stop Orange → Action, Warning, Warm Yellow → Important, Attention Green → Success, Natural, Content Blue → Logic, Stability, Cool Cyan → Technical, Meta Violet → Abstract, Special This gave me a logical way to assign colors:
Code Element Why This Color Oklab Values Keywords Action → Orange (0.68, 0.055, 0.065) Functions Logic → Blue (0.68, -0.02, -0.06) Types Important → Yellow (0.68, 0.02, 0.08) Errors Danger → Red (0.66, 0.08, 0.04) Strings Content → Green (0.64, -0.05, 0.06) Constants Technical → Cyan (0.64, -0.055, -0.01) Numbers Abstract → Violet (0.64, 0.05, -0.04) Putting It All Together Here&rsquo;s the final palette. Every value comes from those principles, not random guesses:
local colors = {} -- Background and text colors.bg = oklab_to_srgb(0.24, 0.001, 0.006) colors.fg = oklab_to_srgb(0.74, 0.0, 0.008) -- Layer 1: Structure (brightest) colors.orange = oklab_to_srgb(0.68, 0.055, 0.065) -- Keywords colors.blue = oklab_to_srgb(0.68, -0.02, -0.06) -- Functions colors.yellow = oklab_to_srgb(0.68, 0.02, 0.08) -- Types -- Layer 2: Diagnostics colors.red = oklab_to_srgb(0.66, 0.08, 0.04) -- Errors -- Layer 3: Data colors.green = oklab_to_srgb(0.64, -0.05, 0.06) -- Strings colors.cyan = oklab_to_srgb(0.64, -0.055, -0.01) -- Constants colors.violet = oklab_to_srgb(0.64, 0.05, -0.04) -- Numbers return colors And the highlight groups:
-- Important stuff (bright) vim.api.nvim_set_hl(0, &#39;Keyword&#39;, { fg = colors.orange }) vim.api.nvim_set_hl(0, &#39;Function&#39;, { fg = colors.blue }) vim.api.nvim_set_hl(0, &#39;Type&#39;, { fg = colors.yellow }) -- Less important (dimmer) vim.api.nvim_set_hl(0, &#39;String&#39;, { fg = colors.green }) vim.api.nvim_set_hl(0, &#39;Constant&#39;, { fg = colors.cyan }) vim.api.nvim_set_hl(0, &#39;Number&#39;, { fg = colors.violet }) -- Neutral (same as regular text) vim.api.nvim_set_hl(0, &#39;Identifier&#39;, { fg = colors.fg }) -- Variables vim.api.nvim_set_hl(0, &#39;Operator&#39;, { fg = colors.fg }) -- =, +, -, etc. Does It Actually Work? Don&rsquo;t doubt it, this is still neovim 😏. I&rsquo;ve been using this theme (I call it Retina) for two months now. Here&rsquo;s what I&rsquo;ve noticed:
My eyes don&rsquo;t get tired anymore. I can code for hours without that strained feeling. Errors actually stand out. That slight brightness bump makes all the difference. I can see the code&rsquo;s structure immediately. My eyes naturally follow the bright keywords. It&rsquo;s&hellip; quiet. With most variables staying neutral, there&rsquo;s way less visual noise. A Quick Reality Check Look, vision is personal. This works for me, but your eyes might be different. Things that matter:
Your age (older eyes often need more contrast) Your monitor (OLED vs LCD, different calibrations) Your environment (dark room vs bright office) Your color vision (about 8% of men see colors differently) The beauty of this approach is you can adjust the parameters instead of guessing:
-- Need more contrast? Bump up the brightness: colors.orange = oklab_to_srgb(0.70, 0.055, 0.065) -- Was 0.68 -- Colors too strong? Tone down the saturation: colors.orange = oklab_to_srgb(0.68, 0.044, 0.052) -- 20% less saturation -- Want different hues? Adjust the a,b ratio: colors.orange = oklab_to_srgb(0.68, 0.050, 0.070) -- More yellow You&rsquo;re tuning a system, not just picking random colors.
The best theme really is the one you forget you&rsquo;re using. It just gets out of your way and lets you focus on the code.
References &amp; Further Reading Oklab color space: https://bottosson.github.io/posts/oklab/ Contrast Sensitivity Function: Barten, P. G. J. (1999) Color Appearance Models: Fairchild, M. D. (2013) Visual Fatigue Study: Fan et al. (2024) Color Semantics: Schloss, K. B. (2024) Vision and Aging: Owsley, C. (2016) Syntax Highlighting Research: Hannebauer et al. (2018) &ldquo;Syntax Highlighting is a Waste of Time&rdquo;: https://tonsky.me/blog/syntax-highlighting/ You can find the complete theme on GitHub. Use it, tweak it, or just steal the ideas for your own theme. Either way, I hope it helps you break out of the endless theme-tweaking cycle.
`,url:"https://www.functor.me/posts/colorscheme/"},"https://www.functor.me/tags/vision-research/":{title:"Vision-Research",tags:[],content:"",url:"https://www.functor.me/tags/vision-research/"},"https://www.functor.me/categories/":{title:"Categories",tags:[],content:"",url:"https://www.functor.me/categories/"}}</script></footer></body></html>