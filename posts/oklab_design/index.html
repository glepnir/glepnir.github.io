<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=cache-control content="max-age=0"><meta http-equiv=cache-control content="no-cache"><meta http-equiv=expires content="0"><meta http-equiv=expires content="Tue, 01 Jan 1980 1:00:00 GMT"><meta http-equiv=pragma content="no-cache"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png }><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#1b1b1b"><meta name=description content="Stop Guessing Hex Codes: A Better Way to Pick Theme Colors"><title>Stop Guessing Hex Codes: A Better Way to Pick Theme Colors | glepnir's blog</title><style>:root{--background:#ffffff}@media(prefers-color-scheme:dark){:root{--background:#1b1b1b}}html{background-color:var(--background)}body{background-color:var(--background)}</style><link rel=stylesheet type=text/css href=/style.min.0e9c0bb0a7de7a330263937778a4d7c0d0c6be7f327c69a0223c9f2fd31e00d5.css media=all><link rel=stylesheet href=/css/katex.min.css integrity="sha512-0u6F0kGPTUgsoq8qPa0w03CxxmEz3qYfl9eTPJL8DK4QJE9/XL1SSoiXoYhvDXCrBMBVWtaAIWsWoCg1TkJybA==" crossorigin=anonymous></head><body><nav><ul class=menu><li><a tabindex=-1 class=menu-link href=/><u>H</u>ome</a></li><li><a tabindex=-1 class=menu-link href=/tags><u>T</u>ags</a></li></ul></nav><div id=single-header><h1>Stop Guessing Hex Codes: A Better Way to Pick Theme Colors</h1><div id=single-meta><span class=datesub>Dec 24, 2025</span>
<span id=tags>&nbsp;&nbsp;
<span><a href=https://www.functor.me/tags/neovim/>#neovim</a>
</span>&nbsp; <span><a href=https://www.functor.me/tags/oklab/>#oklab</a>
</span>&nbsp; <span><a href=https://www.functor.me/tags/color-theory/>#color-theory</a>
</span>&nbsp;</span></div></div><aside class="hidden lg:block toc" id=tableOfContentContainer><nav id=TableOfContents><ul><li><a href=#rgbhsl-are-kinda-broken-for-this>RGB/HSL Are Kinda Broken for This</a></li><li><a href=#enter-oklab-colors-that-actually-make-sense>Enter Oklab: Colors That Actually Make Sense</a></li><li><a href=#implementation>Implementation</a></li><li><a href=#designing-a-palette>Designing a Palette</a></li><li><a href=#how-to-pick-ab-values-hue>How to Pick a/b Values (Hue)</a></li><li><a href=#blending-colors>Blending Colors</a></li><li><a href=#putting-it-together>Putting It Together</a></li><li><a href=#why-this-actually-helps>Why This Actually Helps</a></li><li><a href=#some-practical-tips>Some Practical Tips</a></li><li><a href=#references>References</a></li></ul></nav></aside><main><p>I&rsquo;ve probably made like 20 different Neovim themes over the years. Each time I
thought &ldquo;this is the one&rdquo; and each time, a month later, I&rsquo;d be tweaking colors
again because something just felt&mldr; off.</p><p>The problem? I was doing what everyone doesâ€”picking colors by eye, converting
between RGB and HSL, hoping the math would somehow make sense. Spoiler: it
doesn&rsquo;t.</p><p>Then I found Oklab and everything got way easier.</p><h2 id=rgbhsl-are-kinda-broken-for-this>RGB/HSL Are Kinda Broken for This</h2><p>Here&rsquo;s the thing: in RGB, changing red from 200 to 210 might look like a tiny
shift, but changing blue from 200 to 210 could be a massive difference. HSL is
better but still weirdâ€”adjusting saturation can make some colors way brighter
and others barely change.</p><p>You end up with this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=c1>-- Wait, which one is brighter? ðŸ¤·</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>color1</span> <span class=o>=</span> <span class=s2>&#34;#c5895b&#34;</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>color2</span> <span class=o>=</span> <span class=s2>&#34;#a87d52&#34;</span>
</span></span></code></pre></div><p>No idea without actually looking at them. And if you want to make color1 &ldquo;just a
bit dimmer&rdquo;? Good luck.</p><h2 id=enter-oklab-colors-that-actually-make-sense>Enter Oklab: Colors That Actually Make Sense</h2><p>Oklab is a &ldquo;perceptually uniform&rdquo; color space. Translation: move a color 0.1
units and it <em>looks</em> 0.1 units different. Predictably.</p><p>It has three channels:</p><ul><li><strong>L</strong> (0-1): Brightness. 0 = black, 1 = white, simple.</li><li><strong>a</strong> (-0.4 to +0.4): Red â†” Green</li><li><strong>b</strong> (-0.4 to +0.4): Yellow â†” Blue</li></ul><p>Want an orange that&rsquo;s 68% bright? Easy:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.68</span><span class=p>,</span> <span class=mf>0.055</span><span class=p>,</span> <span class=mf>0.065</span><span class=p>)</span>  <span class=c1>-- L=0.68, slightly red, slightly yellow = orange</span>
</span></span></code></pre></div><p>Want it brighter? Change the first number:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.72</span><span class=p>,</span> <span class=mf>0.055</span><span class=p>,</span> <span class=mf>0.065</span><span class=p>)</span>  <span class=c1>-- Same hue, 4% brighter</span>
</span></span></code></pre></div><p>That&rsquo;s it. No guessing.</p><h2 id=implementation>Implementation</h2><p>The conversion from Oklab to RGB goes through a few steps:</p><p><strong>Step 1: Oklab â†’ LMS (cone response)</strong></p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>l</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>m</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>s</mi></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.3963</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.2158</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mn>0.1056</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mn>0.0639</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mn>0.0895</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mn>1.2915</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>L</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>a</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">
\begin{bmatrix} l \\ m \\ s \end{bmatrix} = \begin{bmatrix} 1 &amp; 0.3963 &amp; 0.2158 \\ 1 &amp; -0.1056 &amp; -0.0639 \\ 1 &amp; -0.0895 &amp; -1.2915 \end{bmatrix} \begin{bmatrix} L \\ a \\ b \end{bmatrix}
</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:3.6em;vertical-align:-1.55em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M403 1759V84H666V0H319V1759v0 1759h347v-84H403zm0 0V0H319V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal" style=margin-right:.01968em>l</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">m</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">s</span></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mclose><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M347 1759V0H0V84H263V1759v0 1759H0v84H347zm0 0V0H263V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:3.6em;vertical-align:-1.55em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M403 1759V84H666V0H319V1759v0 1759h347v-84H403zm0 0V0H319V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0.3963</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>âˆ’</span><span class=mord>0.1056</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>âˆ’</span><span class=mord>0.0895</span></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0.2158</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>âˆ’</span><span class=mord>0.0639</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>âˆ’</span><span class=mord>1.2915</span></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mclose><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M347 1759V0H0V84H263V1759v0 1759H0v84H347zm0 0V0H263V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M403 1759V84H666V0H319V1759v0 1759h347v-84H403zm0 0V0H319V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">L</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">a</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">b</span></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mclose><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M347 1759V0H0V84H263V1759v0 1759H0v84H347zm0 0V0H263V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span></span></span></span></span><p><strong>Step 2: Inverse cube root</strong></p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mtext>LMS</mtext><mtext>linear</mtext></msub><mo>=</mo><mo stretchy="false">[</mo><msup><mi>l</mi><mn>3</mn></msup><mo separator="true">,</mo><msup><mi>m</mi><mn>3</mn></msup><mo separator="true">,</mo><msup><mi>s</mi><mn>3</mn></msup><msup><mo stretchy="false">]</mo><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">
\text{LMS}_{\text{linear}} = [l^3, m^3, s^3]^T
</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord text"><span class=mord>LMS</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">linear</span></span></span></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.1413em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8641em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8641em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8641em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class=mclose><span class=mclose>]</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8913em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.13889em>T</span></span></span></span></span></span></span></span></span></span></span></span><p><strong>Step 3: LMS â†’ Linear RGB</strong></p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>R</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>G</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>B</mi></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>4.0767</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mn>3.3077</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.2310</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mn>1.2684</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2.6098</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mn>0.3413</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mn>0.0042</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mn>0.7034</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1.7076</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>l</mi><mn>3</mn></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>m</mi><mn>3</mn></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>s</mi><mn>3</mn></msup></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">
\begin{bmatrix} R \\ G \\ B \end{bmatrix} = \begin{bmatrix} 4.0767 &amp; -3.3077 &amp; 0.2310 \\ -1.2684 &amp; 2.6098 &amp; -0.3413 \\ -0.0042 &amp; -0.7034 &amp; 1.7076 \end{bmatrix} \begin{bmatrix} l^3 \\ m^3 \\ s^3 \end{bmatrix}
</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:3.6em;vertical-align:-1.55em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M403 1759V84H666V0H319V1759v0 1759h347v-84H403zm0 0V0H319V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal" style=margin-right:.00773em>R</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">G</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal" style=margin-right:.05017em>B</span></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mclose><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M347 1759V0H0V84H263V1759v0 1759H0v84H347zm0 0V0H263V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:3.6em;vertical-align:-1.55em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M403 1759V84H666V0H319V1759v0 1759h347v-84H403zm0 0V0H319V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>4.0767</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>âˆ’</span><span class=mord>1.2684</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>âˆ’</span><span class=mord>0.0042</span></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>âˆ’</span><span class=mord>3.3077</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>2.6098</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>âˆ’</span><span class=mord>0.7034</span></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0.2310</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>âˆ’</span><span class=mord>0.3413</span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1.7076</span></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mclose><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M347 1759V0H0V84H263V1759v0 1759H0v84H347zm0 0V0H263V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=minner><span class=mopen><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M403 1759V84H666V0H319V1759v0 1759h347v-84H403zm0 0V0H319V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span><span style=top:-1.81em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class="mord mathnormal">s</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span><span class=mclose><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:2.05em><span style=top:-4.05em><span class=pstrut style=height:5.6em></span><span style=width:.667em;height:3.6em><svg width=".667em" height="3.6em" viewBox="0 0 667 3600"><path d="M347 1759V0H0V84H263V1759v0 1759H0v84H347zm0 0V0H263V1759v0 1759h84z"/></svg></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.55em><span></span></span></span></span></span></span></span></span></span></span></span><p><strong>Step 4: Gamma correction (sRGB)</strong></p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>C</mi><mtext>sRGB</mtext></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>12.92</mn><mo>Ã—</mo><msub><mi>C</mi><mtext>linear</mtext></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>ifÂ </mtext><msub><mi>C</mi><mtext>linear</mtext></msub><mo>â‰¤</mo><mn>0.0031308</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1.055</mn><mo>Ã—</mo><msubsup><mi>C</mi><mtext>linear</mtext><mrow><mn>1</mn><mi mathvariant="normal">/</mi><mn>2.4</mn></mrow></msubsup><mo>âˆ’</mo><mn>0.055</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>otherwise</mtext></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
C_{\text{sRGB}} = \begin{cases} 12.92 \times C_{\text{linear}} &amp; \text{if } C_{\text{linear}} \leq 0.0031308 \\ 1.055 \times C_{\text{linear}}^{1/2.4} - 0.055 &amp; \text{otherwise} \end{cases}
</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3283em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">sRGB</span></span></span></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:3em;vertical-align:-1.25em></span><span class=minner><span class="mopen delimcenter" style=top:0><span class="delimsizing size4">{</span></span><span class=mord><span class=mtable><span class=col-align-l><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.7084em><span style=top:-3.7452em><span class=pstrut style=height:3.0448em></span><span class=mord><span class=mord>12.92</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>Ã—</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">linear</span></span></span></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span><span style=top:-2.2684em><span class=pstrut style=height:3.0448em></span><span class=mord><span class=mord>1.055</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>Ã—</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.0448em><span style=top:-2.3987em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">linear</span></span></span></span></span><span style=top:-3.2198em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1/2.4</span></span></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:.3013em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>âˆ’</span><span class=mspace style=margin-right:.2222em></span><span class=mord>0.055</span></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.2084em><span></span></span></span></span></span><span class=arraycolsep style=width:1em></span><span class=col-align-l><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.7084em><span style=top:-3.7452em><span class=pstrut style=height:3.0448em></span><span class=mord><span class="mord text"><span class=mord>ifÂ </span></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">linear</span></span></span></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>â‰¤</span><span class=mspace style=margin-right:.2778em></span><span class=mord>0.0031308</span></span></span><span style=top:-2.2684em><span class=pstrut style=height:3.0448em></span><span class=mord><span class="mord text"><span class=mord>otherwise</span></span></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:1.2084em><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><p>Here&rsquo;s the implementation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>oklab_to_linear_rgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>-- Transform Oklab to LMS (cone response)</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>l</span> <span class=o>=</span> <span class=n>L</span> <span class=o>+</span> <span class=mf>0.3963377774</span> <span class=o>*</span> <span class=n>a</span> <span class=o>+</span> <span class=mf>0.2158037573</span> <span class=o>*</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>m</span> <span class=o>=</span> <span class=n>L</span> <span class=o>-</span> <span class=mf>0.1055613458</span> <span class=o>*</span> <span class=n>a</span> <span class=o>-</span> <span class=mf>0.0638541728</span> <span class=o>*</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>s</span> <span class=o>=</span> <span class=n>L</span> <span class=o>-</span> <span class=mf>0.0894841775</span> <span class=o>*</span> <span class=n>a</span> <span class=o>-</span> <span class=mf>1.2914855480</span> <span class=o>*</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>-- Apply inverse cube root</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>l3</span><span class=p>,</span> <span class=n>m3</span><span class=p>,</span> <span class=n>s3</span> <span class=o>=</span> <span class=n>l</span> <span class=o>*</span> <span class=n>l</span> <span class=o>*</span> <span class=n>l</span><span class=p>,</span> <span class=n>m</span> <span class=o>*</span> <span class=n>m</span> <span class=o>*</span> <span class=n>m</span><span class=p>,</span> <span class=n>s</span> <span class=o>*</span> <span class=n>s</span> <span class=o>*</span> <span class=n>s</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>-- LMS to linear RGB</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>r</span> <span class=o>=</span> <span class=mf>4.0767416621</span> <span class=o>*</span> <span class=n>l3</span> <span class=o>-</span> <span class=mf>3.3077115913</span> <span class=o>*</span> <span class=n>m3</span> <span class=o>+</span> <span class=mf>0.2309699292</span> <span class=o>*</span> <span class=n>s3</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>g</span> <span class=o>=</span> <span class=o>-</span><span class=mf>1.2684380046</span> <span class=o>*</span> <span class=n>l3</span> <span class=o>+</span> <span class=mf>2.6097574011</span> <span class=o>*</span> <span class=n>m3</span> <span class=o>-</span> <span class=mf>0.3413193965</span> <span class=o>*</span> <span class=n>s3</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>b_out</span> <span class=o>=</span> <span class=o>-</span><span class=mf>0.0041960863</span> <span class=o>*</span> <span class=n>l3</span> <span class=o>-</span> <span class=mf>0.7034186147</span> <span class=o>*</span> <span class=n>m3</span> <span class=o>+</span> <span class=mf>1.7076147010</span> <span class=o>*</span> <span class=n>s3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>return</span> <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b_out</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>linear_to_srgb_component</span><span class=p>(</span><span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>if</span> <span class=n>c</span> <span class=o>&lt;=</span> <span class=mf>0.0031308</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=n>c</span> <span class=o>*</span> <span class=mf>12.92</span>
</span></span><span class=line><span class=cl>  <span class=kr>else</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=mf>1.055</span> <span class=o>*</span> <span class=p>(</span><span class=n>c</span> <span class=o>^</span> <span class=p>(</span><span class=mi>1</span> <span class=o>/</span> <span class=mf>2.4</span><span class=p>))</span> <span class=o>-</span> <span class=mf>0.055</span>
</span></span><span class=line><span class=cl>  <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b_comp</span> <span class=o>=</span> <span class=n>oklab_to_linear_rgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>r</span> <span class=o>=</span> <span class=n>linear_to_srgb_component</span><span class=p>(</span><span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>g</span> <span class=o>=</span> <span class=n>linear_to_srgb_component</span><span class=p>(</span><span class=n>g</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>b_comp</span> <span class=o>=</span> <span class=n>linear_to_srgb_component</span><span class=p>(</span><span class=n>b_comp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>-- Convert to 8-bit and clamp</span>
</span></span><span class=line><span class=cl>  <span class=n>r</span> <span class=o>=</span> <span class=n>math.floor</span><span class=p>(</span><span class=n>math.max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>math.min</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>r</span><span class=p>))</span> <span class=o>*</span> <span class=mi>255</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>g</span> <span class=o>=</span> <span class=n>math.floor</span><span class=p>(</span><span class=n>math.max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>math.min</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>g</span><span class=p>))</span> <span class=o>*</span> <span class=mi>255</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>b_comp</span> <span class=o>=</span> <span class=n>math.floor</span><span class=p>(</span><span class=n>math.max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>math.min</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>b_comp</span><span class=p>))</span> <span class=o>*</span> <span class=mi>255</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>return</span> <span class=n>string.format</span><span class=p>(</span><span class=s1>&#39;#%02x%02x%02x&#39;</span><span class=p>,</span> <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b_comp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><p>Those magic numbers come from the Oklab spec. Just copy-paste and it works.</p><h2 id=designing-a-palette>Designing a Palette</h2><p>Here&rsquo;s how I actually use this. Instead of random hex codes, I think in terms of
brightness and hue.</p><p><strong>Background and foreground first:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>colors</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Dark but not pure black (L=0.24, basically neutral)</span>
</span></span><span class=line><span class=cl><span class=n>colors.bg</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.24</span><span class=p>,</span> <span class=mf>0.001</span><span class=p>,</span> <span class=mf>0.006</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Bright text (L=0.74, also basically neutral)</span>
</span></span><span class=line><span class=cl><span class=n>colors.fg</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.74</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.008</span><span class=p>)</span>
</span></span></code></pre></div><p><strong>Then decide on a brightness hierarchy.</strong></p><p>There are two common approaches:</p><p><strong>Style 1: Structure-First</strong></p><ul><li>Brighten keywords, functions, types - emphasize code structure</li><li>Dim data (strings, numbers) - they&rsquo;re secondary</li><li>Example: structure at L=0.68, data at L=0.64</li></ul><p><strong>Style 2: Data-First</strong> (<a href=https://tonsky.me/blog/syntax-highlighting/ target=_blank rel="noreferrer nofollow">Tonsky&rsquo;s philosophy</a>)</p><ul><li>Dim keywords (low brightness + low saturation) - they&rsquo;re just syntactic noise</li><li>Brighten function definitions, strings, numbers - that&rsquo;s your actual code</li><li>Example: keywords at L=0.60, data at L=0.68-0.70</li></ul><h2 id=how-to-pick-ab-values-hue>How to Pick a/b Values (Hue)</h2><p>Here&rsquo;s a quick reference for common colors in Oklab space:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=c1>-- Red: a &gt; 0, b near 0 or slightly positive</span>
</span></span><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=mf>0.08</span><span class=p>,</span> <span class=mf>0.04</span><span class=p>)</span>   <span class=c1>-- orange-red</span>
</span></span><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=mf>0.10</span><span class=p>,</span> <span class=mf>0.02</span><span class=p>)</span>   <span class=c1>-- pure red</span>
</span></span><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=mf>0.10</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.02</span><span class=p>)</span>  <span class=c1>-- magenta-red</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Orange: a &gt; 0, b &gt; 0, roughly equal</span>
</span></span><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=mf>0.055</span><span class=p>,</span> <span class=mf>0.065</span><span class=p>)</span> <span class=c1>-- typical orange</span>
</span></span><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=mf>0.05</span><span class=p>,</span> <span class=mf>0.07</span><span class=p>)</span>   <span class=c1>-- more yellow-orange</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Yellow: a â‰ˆ 0, b &gt; 0</span>
</span></span><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=mf>0.02</span><span class=p>,</span> <span class=mf>0.08</span><span class=p>)</span>   <span class=c1>-- yellow-orange</span>
</span></span><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.08</span><span class=p>)</span>    <span class=c1>-- pure yellow</span>
</span></span><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.02</span><span class=p>,</span> <span class=mf>0.08</span><span class=p>)</span>  <span class=c1>-- yellow-green</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Green: a &lt; 0, b &gt; 0</span>
</span></span><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.05</span><span class=p>,</span> <span class=mf>0.06</span><span class=p>)</span>  <span class=c1>-- typical green</span>
</span></span><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.08</span><span class=p>,</span> <span class=mf>0.04</span><span class=p>)</span>  <span class=c1>-- deeper green</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Cyan: a &lt; 0, b &lt; 0, |a| &gt; |b|</span>
</span></span><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.055</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.01</span><span class=p>)</span> <span class=c1>-- cyan</span>
</span></span><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.06</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.03</span><span class=p>)</span>  <span class=c1>-- more blue-cyan</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Blue: a &lt; 0, b &lt; 0, |b| &gt; |a|</span>
</span></span><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.02</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.06</span><span class=p>)</span>  <span class=c1>-- typical blue</span>
</span></span><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.01</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.08</span><span class=p>)</span>  <span class=c1>-- deeper blue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Violet/Purple: a &gt; 0, b &lt; 0</span>
</span></span><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=mf>0.05</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.04</span><span class=p>)</span>   <span class=c1>-- violet</span>
</span></span><span class=line><span class=cl><span class=n>oklab_to_srgb</span><span class=p>(</span><span class=n>L</span><span class=p>,</span> <span class=mf>0.08</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.06</span><span class=p>)</span>   <span class=c1>-- purple</span>
</span></span></code></pre></div><p><strong>Saturation control:</strong> <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>saturation</mtext><mo>=</mo><msqrt><mrow><msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding="application/x-tex">\text{saturation} = \sqrt{a^2 + b^2}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6679em></span><span class="mord text"><span class=mord>saturation</span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.04em;vertical-align:-.1266em></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.9134em><span class=svg-align style=top:-3em><span class=pstrut style=height:3em></span><span class=mord style=padding-left:.833em><span class=mord><span class="mord mathnormal">a</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7401em><span style=top:-2.989em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7401em><span style=top:-2.989em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style=top:-2.8734em><span class=pstrut style=height:3em></span><span class=hide-tail style=min-width:.853em;height:1.08em><svg width="400em" height="1.08em" viewBox="0 0 4e5 1080" preserveAspectRatio="xMinYMin slice"><path d="M95 702c-2.7.0-7.17-2.7-13.5-8-5.8-5.3-9.5-10-9.5-14 0-2 .3-3.3 1-4 1.3-2.7 23.83-20.7 67.5-54 44.2-33.3 65.8-50.3 66.5-51 1.3-1.3 3-2 5-2 4.7.0 8.7 3.3 12 10s173 378 173 378c.7.0 35.3-71 104-213s137.5-285 206.5-429S812 97.3 814 94c5.3-9.3 12-14 20-14H4e5v40H845.2724s-225.272 467-225.272 467-235 486-235 486c-2.7 4.7-9 7-19 7-6 0-10-1-12-3s-194-422-194-422-65 47-65 47zM834 80h4e5v40H834z"/></svg></span></span></span><span class=vlist-s>â€‹</span></span><span class=vlist-r><span class=vlist style=height:.1266em><span></span></span></span></span></span></span></span></span></p><ul><li><code>s &lt; 0.05</code>: very muted, almost gray</li><li><code>s â‰ˆ 0.08</code>: moderate, comfortable for long sessions</li><li><code>s > 0.10</code>: vivid, can be fatiguing</li></ul><p>So if you want a &ldquo;medium orange at 68% brightness with moderate saturation
around 0.08&rdquo;:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=c1>-- Start with the hue ratio you want (orange â‰ˆ equal a and b)</span>
</span></span><span class=line><span class=cl><span class=c1>-- Then scale to get saturation â‰ˆ 0.08</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>orange</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.68</span><span class=p>,</span> <span class=mf>0.055</span><span class=p>,</span> <span class=mf>0.065</span><span class=p>)</span>  <span class=c1>-- sqrt(0.055Â² + 0.065Â²) â‰ˆ 0.085</span>
</span></span></code></pre></div><h2 id=blending-colors>Blending Colors</h2><p>Sometimes you need a subtle background colorâ€”like for diagnostic messages. You
want it to be related to the error color but way more subtle.</p><p>Here&rsquo;s my blend function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>hex_to_rgb</span><span class=p>(</span><span class=n>hex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>hex</span> <span class=o>=</span> <span class=n>hex</span><span class=p>:</span><span class=n>gsub</span><span class=p>(</span><span class=s1>&#39;#&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>tonumber</span><span class=p>(</span><span class=n>hex</span><span class=p>:</span><span class=n>sub</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=mi>16</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>tonumber</span><span class=p>(</span><span class=n>hex</span><span class=p>:</span><span class=n>sub</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>),</span> <span class=mi>16</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>tonumber</span><span class=p>(</span><span class=n>hex</span><span class=p>:</span><span class=n>sub</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>),</span> <span class=mi>16</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>rgb_to_hex</span><span class=p>(</span><span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>return</span> <span class=n>string.format</span><span class=p>(</span><span class=s1>&#39;#%02x%02x%02x&#39;</span><span class=p>,</span> <span class=n>c</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>c</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>c</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>blend</span><span class=p>(</span><span class=n>fg</span><span class=p>,</span> <span class=n>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>hex_to_rgb</span><span class=p>(</span><span class=n>fg</span><span class=p>),</span> <span class=n>hex_to_rgb</span><span class=p>(</span><span class=n>colors.bg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>c</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>math.floor</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>t</span><span class=p>)</span> <span class=o>+</span> <span class=n>b</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>*</span> <span class=n>t</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>math.floor</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>t</span><span class=p>)</span> <span class=o>+</span> <span class=n>b</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>*</span> <span class=n>t</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>math.floor</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>t</span><span class=p>)</span> <span class=o>+</span> <span class=n>b</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>*</span> <span class=n>t</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>return</span> <span class=n>rgb_to_hex</span><span class=p>(</span><span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><p>Use it like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=c1>-- Red error text on a very subtle reddish background</span>
</span></span><span class=line><span class=cl><span class=n>h</span><span class=p>(</span><span class=s1>&#39;DiagnosticVirtualTextError&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>fg</span> <span class=o>=</span> <span class=n>colors.red</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>bg</span> <span class=o>=</span> <span class=n>blend</span><span class=p>(</span><span class=n>colors.red</span><span class=p>,</span> <span class=mf>0.65</span><span class=p>)</span>  <span class=c1>-- 65% background, 35% red</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>The <code>t</code> parameter controls the mix. 0.0 = pure foreground color, 1.0 = pure
background, 0.65 = mostly background with a hint of the foreground.</p><p>This is way better than manually picking a &ldquo;light red&rdquo; background that might not
even match.</p><h2 id=putting-it-together>Putting It Together</h2><p>Just some quick examples of how to use this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=c1>-- Make a few colors</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>orange</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.68</span><span class=p>,</span> <span class=mf>0.055</span><span class=p>,</span> <span class=mf>0.065</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>blue</span>   <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.68</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.02</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.06</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>green</span>  <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.64</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.05</span><span class=p>,</span> <span class=mf>0.06</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>red</span>    <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.66</span><span class=p>,</span> <span class=mf>0.08</span><span class=p>,</span> <span class=mf>0.04</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_hl</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;Keyword&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=n>fg</span> <span class=o>=</span> <span class=n>orange</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_hl</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;Function&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=n>fg</span> <span class=o>=</span> <span class=n>blue</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_hl</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;String&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=n>fg</span> <span class=o>=</span> <span class=n>green</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_hl</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;DiagnosticError&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=n>fg</span> <span class=o>=</span> <span class=n>red</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_hl</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;DiagnosticVirtualTextError&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>bg</span> <span class=o>=</span> <span class=n>blend</span><span class=p>(</span><span class=n>red</span><span class=p>,</span> <span class=mf>0.65</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>That&rsquo;s pretty much it. Pick some L values, tweak the a/b until it looks right, done.</p><h2 id=why-this-actually-helps>Why This Actually Helps</h2><p><strong>Before Oklab:</strong></p><ul><li>&ldquo;This orange looks too bright&mldr; let me try #c58960&mldr; no wait #b87a55&mldr; hmm maybe #ca8e62?&rdquo;</li><li><em>One hour later, still tweaking</em></li></ul><p><strong>After Oklab:</strong></p><ul><li>&ldquo;Too bright? Change L from 0.68 to 0.65&rdquo;</li><li><em>Done in 30 seconds</em></li></ul><p>The real win is <strong>systematic adjustments</strong>:</p><ul><li>Make everything 5% brighter? Add 0.05 to all L values</li><li>Reduce saturation? Scale down all a/b values by 20%</li><li>Switch from data-first to structure-first? Just swap the L values</li></ul><p>You&rsquo;re not guessing anymore. You&rsquo;re tuning a system.</p><h2 id=some-practical-tips>Some Practical Tips</h2><p><strong>Testing colors quickly:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>test</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.68</span><span class=p>,</span> <span class=mf>0.055</span><span class=p>,</span> <span class=mf>0.065</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>test</span><span class=p>)</span>  <span class=c1>-- prints: #c5895b</span>
</span></span></code></pre></div><p><strong>Adjusting systematically:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=c1>-- Make everything 5% brighter</span>
</span></span><span class=line><span class=cl><span class=n>colors.orange</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.73</span><span class=p>,</span> <span class=mf>0.055</span><span class=p>,</span> <span class=mf>0.065</span><span class=p>)</span>  <span class=c1>-- was 0.68</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Reduce saturation by 20%</span>
</span></span><span class=line><span class=cl><span class=n>colors.orange</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.68</span><span class=p>,</span> <span class=mf>0.044</span><span class=p>,</span> <span class=mf>0.052</span><span class=p>)</span>  <span class=c1>-- was (0.055, 0.065)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Warm up the whole palette</span>
</span></span><span class=line><span class=cl><span class=n>colors.orange</span> <span class=o>=</span> <span class=n>oklab_to_srgb</span><span class=p>(</span><span class=mf>0.68</span><span class=p>,</span> <span class=mf>0.055</span><span class=p>,</span> <span class=mf>0.075</span><span class=p>)</span>  <span class=c1>-- increase b value</span>
</span></span></code></pre></div><p><strong>When not to use Oklab:</strong> If you&rsquo;re trying to match an existing hex code
exactly, just use the hex. Oklab is for <em>designing</em> colors, not copying them.</p><hr><h2 id=references>References</h2><ul><li><strong>Oklab spec:</strong> <a href=https://bottosson.github.io/posts/oklab/ target=_blank rel="noreferrer nofollow">https://bottosson.github.io/posts/oklab/</a> (this is where all those magic numbers come from)</li></ul><p>That&rsquo;s it. No need to make this more complicated than it is. Pick some L values
for brightness, tweak a/b until the hues look right, and you&rsquo;re done.</p></main><div class=sponsor><a href=https://github.com/sponsors/glepnir target=_blank rel="noopener noreferrer" class=sponsor-btn>â¤ï¸ Sponsor</a></div><section class=comments><script src=https://giscus.app/client.js data-repo=glepnir/glepnir.github.io data-repo-id data-category=General data-category-id data-mapping=pathname data-strict=0 data-reactions-enabled data-emit-metadata data-input-position data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script></section><br><footer class=site-footer><p class=footer-meta>Â© 2025 glepnir Â·
<a href=https://github.com/glepnir>GitHub</a> Â·
<a href=https://reddit.com/u/glephunter>Reddit</a> Â·
<a href=https://www.functor.me/index.xml>RSS</a></p><script defer>document.addEventListener("keydown",function(e){if(document.activeElement.isContentEditable)return!1;if(document.activeElement.tagName=="INPUT")return!1;if(e.altKey||e.ctrlKey||e.shiftKey)return!1;var t=e.key;if(t==="h")e.preventDefault(),e.stopPropagation(),window.location.href="/";else if(t==="t")e.preventDefault(),e.stopPropagation(),window.location.href=`https://${location.hostname}/tags`;else if(t==="i"){e.preventDefault(),e.stopPropagation();const t=document.querySelectorAll("input");for(let e=0;e<t.length;e++)if(t[e].offsetParent!==null){t[e].selectionStart=t[e].selectionEnd=t[e].value.length,t[e].focus();break}}return!1})</script><script defer>function throttle(e,t){var n=Date.now();return function(){var s=Date.now();n+t-s<0&&(e(),n=s)}}function scrollHandler(){const e=Array.from(document.querySelectorAll("body h2, body h3"));function t(){for(var n,s,o,i=window.pageYOffset||document.documentElement.scrollTop,t=0;t<e.length;t++)s=e[t].getAttribute("id"),n=document.querySelector('nav ul li a[href="#'+s+'"]'),n&&n.classList.remove("active-toc");for(t=e.length-1;t>=0;t--)if(o=e[t].offsetTop,i>o-75&&(s=e[t].getAttribute("id"),n=document.querySelector('nav ul li a[href="#'+s+'"]'),n)){n.classList.add("active-toc");break}}window.addEventListener("scroll",throttle(t,200))}setTimeout(scrollHandler,100)</script><script defer>function getTextContentRecursively(e){let t="";if(e.nodeType===Node.TEXT_NODE)return e.textContent||"";for(const n of e.childNodes)t+=getTextContentRecursively(n);return t}function addCopyButtonToCodeBlocks(){const e=document.querySelectorAll('code[class^="language-"]:not(.output):not([class*="language-console"])');e.forEach(e=>{const t=document.createElement("button");t.classList.add("copy-code-button"),t.innerHTML="copy",t.addEventListener("click",()=>{const n=getTextContentRecursively(e);navigator.clipboard.writeText(n),t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},1500)}),e.parentNode.before(t)})}setTimeout(function(){addCopyButtonToCodeBlocks()},100)</script><script>window.store={"https://www.functor.me/":{title:"glepnir's blog",tags:[],content:"",url:"https://www.functor.me/"},"https://www.functor.me/posts/":{title:"Posts",tags:[],content:"",url:"https://www.functor.me/posts/"},"https://www.functor.me/posts/thought_fp/":{title:"When Loops Become Math: How Functional Thinking Changed My C++",tags:[],content:`Last week, I was staring at two pieces of code a friend had sent me, asking which one I preferred. They looked like this:
// Version A double calculate_mean(const vector&lt;double&gt;&amp; data) { double sum = 0.0; for (const auto&amp; x : data) { sum += x; } return sum / data.size(); } // Version B double calculate_stddev(const vector&lt;double&gt;&amp; data) { double sum = 0.0; double mean = calculate_mean(data); for (const auto&amp; x : data) { sum += (x - mean) * (x - mean); } return sqrt(sum / data.size()); } I looked at them for a solid five seconds before it hit me: these two loops were fundamentally the same mathematical pattern! But in the code, that pattern was buried under for loops and accumulation variables.
Seeing with Math Eyes In math, we&rsquo;d write these calculations as:
mean=1nâˆ‘i=1nxi \\text{mean} = \\frac{1}{n} \\sum_{i=1}^n x_i mean=n1â€‹i=1âˆ‘nâ€‹xiâ€‹stddev=1nâˆ‘i=1n(xiâˆ’Î¼)2 \\text{stddev} = \\sqrt{\\frac{1}{n} \\sum_{i=1}^n (x_i - \\mu)^2} stddev=n1â€‹i=1âˆ‘nâ€‹(xiâ€‹âˆ’Î¼)2â€‹See that $\\sum$ symbol? That&rsquo;s our abstraction point. In functional programming, this is called a fold (or reduce), defined as:
fold(f,z,[x1,x2,...,xn])=f(f(f(z,x1),x2),...,xn) \\text{fold}(f, z, [x_1, x_2, ..., x_n]) = f(f(f(z, x_1), x_2), ..., x_n) fold(f,z,[x1â€‹,x2â€‹,...,xnâ€‹])=f(f(f(z,x1â€‹),x2â€‹),...,xnâ€‹)Looking at my code with this new perspective:
template&lt;typename T, typename BinaryOp&gt; T fold(const vector&lt;T&gt;&amp; vec, T init, BinaryOp op) { T result = init; for (const auto&amp; x : vec) { result = op(result, x); } return result; } Now both calculations become:
double mean = fold(data, 0.0, plus&lt;double&gt;{}) / data.size(); double variance = fold(data, 0.0, [mean](double acc, double x) { return acc + (x - mean) * (x - mean); }) / data.size(); The Real Breakthrough: Seeing Deeper Patterns I started noticing this pattern everywhere. Take this convex hull algorithm I&rsquo;d written:
vector&lt;Point&gt; find_convex_hull(const vector&lt;Point&gt;&amp; points) { vector&lt;Point&gt; hull; for (size_t i = 0; i &lt; points.size(); ++i) { for (size_t j = 0; j &lt; points.size(); ++j) { if (i == j) continue; bool all_on_same_side = true; for (size_t k = 0; k &lt; points.size(); ++k) { if (k == i || k == j) continue; if (!is_on_same_side(points[i], points[j], points[k])) { all_on_same_side = false; break; } } if (all_on_same_side) { hull.push_back(points[i]); hull.push_back(points[j]); } } } return remove_duplicates(hull); } Three nested loops! But with functional thinking, I saw predicate logic:
A point pair (i,j) belongs to the convex hull boundary if and only if all other points are on the same side of the line segment (i,j).
Mathematically: (i,j)âˆˆhullâ€…âŸºâ€…âˆ€kâ‰ i,j:same_side(i,j,k) (i,j) \\in \\text{hull} \\iff \\forall k \\neq i,j : \\text{same\\_side}(i,j,k) (i,j)âˆˆhullâŸºâˆ€kî€ =i,j:same_side(i,j,k)In C++, this becomes:
vector&lt;Point&gt; find_convex_hull_fp(const vector&lt;Point&gt;&amp; points) { auto pairs = cartesian_product(points, points); auto is_hull_edge = [&amp;](const pair&lt;Point, Point&gt;&amp; edge) { return all_of(points.begin(), points.end(), [&amp;](const Point&amp; p) { return &amp;p == &amp;edge.first || &amp;p == &amp;edge.second || is_on_same_side(edge.first, edge.second, p); }); }; return filter(pairs, is_hull_edge) | transform([](auto&amp;&amp; p) { return vector{p.first, p.second}; }) | flatten() | unique(); } Why This Matters: You Can Actually Prove Things Here&rsquo;s the cool part: functional code is easier to reason about.
With the original code, proving correctness meant:
Tracking three loop variables Understanding when the break happens Verifying when hull gets updated With the functional version:
cartesian_product generates all point pairs (obvious) is_hull_edge is a direct translation of the mathematical definition The composition uses standard, well-understood operations I can even write tests that verify mathematical properties:
// Convex hull property: all points should be inside the hull TEST(ConvexHull, AllPointsInsideHull) { auto points = generate_random_points(100); auto hull = find_convex_hull_fp(points); for (const auto&amp; p : points) { ASSERT_TRUE(is_point_inside_convex_polygon(p, hull)); } } Category Theory Sneaks In Recently, I was writing a config parser with multiple operations that could fail:
optional&lt;int&gt; parse_timeout(const string&amp; str); optional&lt;string&gt; parse_hostname(const string&amp; str); optional&lt;Config&gt; create_config(int timeout, const string&amp; host); The traditional way:
optional&lt;Config&gt; parse_config(const string&amp; timeout_str, const string&amp; host_str) { auto timeout = parse_timeout(timeout_str); if (!timeout) return nullopt; auto host = parse_hostname(host_str); if (!host) return nullopt; return create_config(*timeout, *host); } The functional way uses a pattern (some people call it a monad, but I just call it useful):
template&lt;typename T, typename Func&gt; auto and_then(const optional&lt;T&gt;&amp; opt, Func f) -&gt; decltype(f(opt.value())) { if (!opt) return decltype(f(opt.value()))(); return f(*opt); } optional&lt;Config&gt; parse_config_fp(const string&amp; timeout_str, const string&amp; host_str) { return and_then(parse_timeout(timeout_str), [&amp;](int timeout) { return and_then(parse_hostname(host_str), [&amp;](const string&amp; host) { return create_config(timeout, host); }); }); } Mathematically, this is composition in the Kleisli category: f:Aâ†’M(B),g:Bâ†’M(C)gâˆ˜Kf:Aâ†’M(C) f: A \\to M(B), \\quad g: B \\to M(C) \\\\ g \\circ_K f: A \\to M(C) f:Aâ†’M(B),g:Bâ†’M(C)gâˆ˜Kâ€‹f:Aâ†’M(C)Performance? Actually Better People say functional code is slow. Modern C++ compilers are smart:
// Hand-written &#34;optimized&#34; version double sum_squares(const vector&lt;double&gt;&amp; data) { double sum = 0.0; for (const auto&amp; x : data) { sum += x * x; } return sum; } // Functional version double sum_squares_fp(const vector&lt;double&gt;&amp; data) { return fold(data, 0.0, [](double acc, double x) { return acc + x * x; }); } With -O3, GCC generates identical assembly for both. The functional version is actually saferâ€”no loop variables, no bounds checking worries.
My New Toolkit Here&rsquo;s what functional thinking added to my C++ toolbox:
map/filter/reduce - The basics for working with collections Function composition - compose(f, g)(x) = f(g(x)) Currying - curry(f)(a)(b) = f(a, b) Lazy evaluation - Using generator or ranges::view Like currying for configuration:
auto create_server = curry([](int port, const string&amp; host, Config config) { return Server{port, host, config}; }); auto create_local_server = create_server(8080, &#34;localhost&#34;); auto server = create_local_server(config); The Mindset Shift Functional programming taught me something important: code is math, and the compiler is my proof assistant.
Before: I wrote loops thinking &ldquo;do this repeatedly&rdquo;. Now: I write fold thinking &ldquo;apply this associative operation&rdquo;.
Before: I wrote conditionals thinking &ldquo;if this, then that&rdquo;. Now: I write filter thinking &ldquo;select elements satisfying this predicate&rdquo;.
This mindset lets me write code that&rsquo;s easier to prove correct. Last week I found a bug and mentally traced it:
Given: filter(is_even, [1,2,3,4]) = [2,4] Given: map(square, [2,4]) = [4,16] Given: fold(add, 0, [4,16]) = 20 Therefore: sum of squares of even numbers = 20 Writing it down like that was the proof.
Functional C++ in the Real World This is how I write production code now:
// HTTP request processing pipeline auto handle_request = compose( validate_request, authenticate, parse_body&lt;Order&gt;, process_order, create_response ); // Or with ranges auto valid_orders = requests | views::filter(is_valid_order) | views::transform(parse_order) | views::filter([](const Order&amp; o) { return o.total &gt; 100.0; }) | views::transform(apply_discount) | ranges::to&lt;vector&gt;(); This isn&rsquo;t &ldquo;functional C++&quot;â€”it&rsquo;s just C++. But it&rsquo;s C++ written with functional thinking.
Finally When I started seeing loops through mathematical eyes, they stopped being loops and became instances of algebraic structures. That perspective lets me write code that&rsquo;s cleaner, more correct, and honestly more fun to write.
Maybe that&rsquo;s the end goal of programming: code stops being instructions and becomes executable mathematics.
`,url:"https://www.functor.me/posts/thought_fp/"},"https://www.functor.me/tags/color-theory/":{title:"Color-Theory",tags:[],content:"",url:"https://www.functor.me/tags/color-theory/"},"https://www.functor.me/tags/neovim/":{title:"Neovim",tags:[],content:"",url:"https://www.functor.me/tags/neovim/"},"https://www.functor.me/tags/oklab/":{title:"Oklab",tags:[],content:"",url:"https://www.functor.me/tags/oklab/"},"https://www.functor.me/posts/oklab_design/":{title:"Stop Guessing Hex Codes: A Better Way to Pick Theme Colors",tags:["neovim","oklab","color-theory"],content:`I&rsquo;ve probably made like 20 different Neovim themes over the years. Each time I thought &ldquo;this is the one&rdquo; and each time, a month later, I&rsquo;d be tweaking colors again because something just felt&hellip; off.
The problem? I was doing what everyone doesâ€”picking colors by eye, converting between RGB and HSL, hoping the math would somehow make sense. Spoiler: it doesn&rsquo;t.
Then I found Oklab and everything got way easier.
RGB/HSL Are Kinda Broken for This Here&rsquo;s the thing: in RGB, changing red from 200 to 210 might look like a tiny shift, but changing blue from 200 to 210 could be a massive difference. HSL is better but still weirdâ€”adjusting saturation can make some colors way brighter and others barely change.
You end up with this:
-- Wait, which one is brighter? ðŸ¤· local color1 = &#34;#c5895b&#34; local color2 = &#34;#a87d52&#34; No idea without actually looking at them. And if you want to make color1 &ldquo;just a bit dimmer&rdquo;? Good luck.
Enter Oklab: Colors That Actually Make Sense Oklab is a &ldquo;perceptually uniform&rdquo; color space. Translation: move a color 0.1 units and it looks 0.1 units different. Predictably.
It has three channels:
L (0-1): Brightness. 0 = black, 1 = white, simple. a (-0.4 to +0.4): Red â†” Green b (-0.4 to +0.4): Yellow â†” Blue Want an orange that&rsquo;s 68% bright? Easy:
oklab_to_srgb(0.68, 0.055, 0.065) -- L=0.68, slightly red, slightly yellow = orange Want it brighter? Change the first number:
oklab_to_srgb(0.72, 0.055, 0.065) -- Same hue, 4% brighter That&rsquo;s it. No guessing.
Implementation The conversion from Oklab to RGB goes through a few steps:
Step 1: Oklab â†’ LMS (cone response) [lms]=[10.39630.21581âˆ’0.1056âˆ’0.06391âˆ’0.0895âˆ’1.2915][Lab] \\begin{bmatrix} l \\\\ m \\\\ s \\end{bmatrix} = \\begin{bmatrix} 1 &amp; 0.3963 &amp; 0.2158 \\\\ 1 &amp; -0.1056 &amp; -0.0639 \\\\ 1 &amp; -0.0895 &amp; -1.2915 \\end{bmatrix} \\begin{bmatrix} L \\\\ a \\\\ b \\end{bmatrix} â€‹lmsâ€‹â€‹=â€‹111â€‹0.3963âˆ’0.1056âˆ’0.0895â€‹0.2158âˆ’0.0639âˆ’1.2915â€‹â€‹â€‹Labâ€‹â€‹Step 2: Inverse cube root LMSlinear=[l3,m3,s3]T \\text{LMS}_{\\text{linear}} = [l^3, m^3, s^3]^T LMSlinearâ€‹=[l3,m3,s3]TStep 3: LMS â†’ Linear RGB [RGB]=[4.0767âˆ’3.30770.2310âˆ’1.26842.6098âˆ’0.3413âˆ’0.0042âˆ’0.70341.7076][l3m3s3] \\begin{bmatrix} R \\\\ G \\\\ B \\end{bmatrix} = \\begin{bmatrix} 4.0767 &amp; -3.3077 &amp; 0.2310 \\\\ -1.2684 &amp; 2.6098 &amp; -0.3413 \\\\ -0.0042 &amp; -0.7034 &amp; 1.7076 \\end{bmatrix} \\begin{bmatrix} l^3 \\\\ m^3 \\\\ s^3 \\end{bmatrix} â€‹RGBâ€‹â€‹=â€‹4.0767âˆ’1.2684âˆ’0.0042â€‹âˆ’3.30772.6098âˆ’0.7034â€‹0.2310âˆ’0.34131.7076â€‹â€‹â€‹l3m3s3â€‹â€‹Step 4: Gamma correction (sRGB) CsRGB={12.92Ã—ClinearifÂ Clinearâ‰¤0.00313081.055Ã—Clinear1/2.4âˆ’0.055otherwise C_{\\text{sRGB}} = \\begin{cases} 12.92 \\times C_{\\text{linear}} &amp; \\text{if } C_{\\text{linear}} \\leq 0.0031308 \\\\ 1.055 \\times C_{\\text{linear}}^{1/2.4} - 0.055 &amp; \\text{otherwise} \\end{cases} CsRGBâ€‹={12.92Ã—Clinearâ€‹1.055Ã—Clinear1/2.4â€‹âˆ’0.055â€‹ifÂ Clinearâ€‹â‰¤0.0031308otherwiseâ€‹Here&rsquo;s the implementation:
local function oklab_to_linear_rgb(L, a, b) -- Transform Oklab to LMS (cone response) local l = L + 0.3963377774 * a + 0.2158037573 * b local m = L - 0.1055613458 * a - 0.0638541728 * b local s = L - 0.0894841775 * a - 1.2914855480 * b -- Apply inverse cube root local l3, m3, s3 = l * l * l, m * m * m, s * s * s -- LMS to linear RGB local r = 4.0767416621 * l3 - 3.3077115913 * m3 + 0.2309699292 * s3 local g = -1.2684380046 * l3 + 2.6097574011 * m3 - 0.3413193965 * s3 local b_out = -0.0041960863 * l3 - 0.7034186147 * m3 + 1.7076147010 * s3 return r, g, b_out end local function linear_to_srgb_component(c) if c &lt;= 0.0031308 then return c * 12.92 else return 1.055 * (c ^ (1 / 2.4)) - 0.055 end end local function oklab_to_srgb(L, a, b) local r, g, b_comp = oklab_to_linear_rgb(L, a, b) r = linear_to_srgb_component(r) g = linear_to_srgb_component(g) b_comp = linear_to_srgb_component(b_comp) -- Convert to 8-bit and clamp r = math.floor(math.max(0, math.min(1, r)) * 255 + 0.5) g = math.floor(math.max(0, math.min(1, g)) * 255 + 0.5) b_comp = math.floor(math.max(0, math.min(1, b_comp)) * 255 + 0.5) return string.format(&#39;#%02x%02x%02x&#39;, r, g, b_comp) end Those magic numbers come from the Oklab spec. Just copy-paste and it works.
Designing a Palette Here&rsquo;s how I actually use this. Instead of random hex codes, I think in terms of brightness and hue.
Background and foreground first:
local colors = {} -- Dark but not pure black (L=0.24, basically neutral) colors.bg = oklab_to_srgb(0.24, 0.001, 0.006) -- Bright text (L=0.74, also basically neutral) colors.fg = oklab_to_srgb(0.74, 0.0, 0.008) Then decide on a brightness hierarchy.
There are two common approaches:
Style 1: Structure-First
Brighten keywords, functions, types - emphasize code structure Dim data (strings, numbers) - they&rsquo;re secondary Example: structure at L=0.68, data at L=0.64 Style 2: Data-First (Tonsky&rsquo;s philosophy)
Dim keywords (low brightness + low saturation) - they&rsquo;re just syntactic noise Brighten function definitions, strings, numbers - that&rsquo;s your actual code Example: keywords at L=0.60, data at L=0.68-0.70 How to Pick a/b Values (Hue) Here&rsquo;s a quick reference for common colors in Oklab space:
-- Red: a &gt; 0, b near 0 or slightly positive oklab_to_srgb(L, 0.08, 0.04) -- orange-red oklab_to_srgb(L, 0.10, 0.02) -- pure red oklab_to_srgb(L, 0.10, -0.02) -- magenta-red -- Orange: a &gt; 0, b &gt; 0, roughly equal oklab_to_srgb(L, 0.055, 0.065) -- typical orange oklab_to_srgb(L, 0.05, 0.07) -- more yellow-orange -- Yellow: a â‰ˆ 0, b &gt; 0 oklab_to_srgb(L, 0.02, 0.08) -- yellow-orange oklab_to_srgb(L, 0.0, 0.08) -- pure yellow oklab_to_srgb(L, -0.02, 0.08) -- yellow-green -- Green: a &lt; 0, b &gt; 0 oklab_to_srgb(L, -0.05, 0.06) -- typical green oklab_to_srgb(L, -0.08, 0.04) -- deeper green -- Cyan: a &lt; 0, b &lt; 0, |a| &gt; |b| oklab_to_srgb(L, -0.055, -0.01) -- cyan oklab_to_srgb(L, -0.06, -0.03) -- more blue-cyan -- Blue: a &lt; 0, b &lt; 0, |b| &gt; |a| oklab_to_srgb(L, -0.02, -0.06) -- typical blue oklab_to_srgb(L, -0.01, -0.08) -- deeper blue -- Violet/Purple: a &gt; 0, b &lt; 0 oklab_to_srgb(L, 0.05, -0.04) -- violet oklab_to_srgb(L, 0.08, -0.06) -- purple Saturation control: saturation=a2+b2\\text{saturation} = \\sqrt{a^2 + b^2}saturation=a2+b2â€‹
s &lt; 0.05: very muted, almost gray s â‰ˆ 0.08: moderate, comfortable for long sessions s &gt; 0.10: vivid, can be fatiguing So if you want a &ldquo;medium orange at 68% brightness with moderate saturation around 0.08&rdquo;:
-- Start with the hue ratio you want (orange â‰ˆ equal a and b) -- Then scale to get saturation â‰ˆ 0.08 local orange = oklab_to_srgb(0.68, 0.055, 0.065) -- sqrt(0.055Â² + 0.065Â²) â‰ˆ 0.085 Blending Colors Sometimes you need a subtle background colorâ€”like for diagnostic messages. You want it to be related to the error color but way more subtle.
Here&rsquo;s my blend function:
local function hex_to_rgb(hex) hex = hex:gsub(&#39;#&#39;, &#39;&#39;) return { tonumber(hex:sub(1, 2), 16), tonumber(hex:sub(3, 4), 16), tonumber(hex:sub(5, 6), 16), } end local function rgb_to_hex(c) return string.format(&#39;#%02x%02x%02x&#39;, c[1], c[2], c[3]) end local function blend(fg, t) local a, b = hex_to_rgb(fg), hex_to_rgb(colors.bg) local c = { math.floor(a[1] * (1 - t) + b[1] * t + 0.5), math.floor(a[2] * (1 - t) + b[2] * t + 0.5), math.floor(a[3] * (1 - t) + b[3] * t + 0.5), } return rgb_to_hex(c) end Use it like this:
-- Red error text on a very subtle reddish background h(&#39;DiagnosticVirtualTextError&#39;, { fg = colors.red, bg = blend(colors.red, 0.65) -- 65% background, 35% red }) The t parameter controls the mix. 0.0 = pure foreground color, 1.0 = pure background, 0.65 = mostly background with a hint of the foreground.
This is way better than manually picking a &ldquo;light red&rdquo; background that might not even match.
Putting It Together Just some quick examples of how to use this:
-- Make a few colors local orange = oklab_to_srgb(0.68, 0.055, 0.065) local blue = oklab_to_srgb(0.68, -0.02, -0.06) local green = oklab_to_srgb(0.64, -0.05, 0.06) local red = oklab_to_srgb(0.66, 0.08, 0.04) vim.api.nvim_set_hl(0, &#39;Keyword&#39;, { fg = orange }) vim.api.nvim_set_hl(0, &#39;Function&#39;, { fg = blue }) vim.api.nvim_set_hl(0, &#39;String&#39;, { fg = green }) vim.api.nvim_set_hl(0, &#39;DiagnosticError&#39;, { fg = red }) vim.api.nvim_set_hl(0, &#39;DiagnosticVirtualTextError&#39;, { bg = blend(red, 0.65) }) That&rsquo;s pretty much it. Pick some L values, tweak the a/b until it looks right, done.
Why This Actually Helps Before Oklab:
&ldquo;This orange looks too bright&hellip; let me try #c58960&hellip; no wait #b87a55&hellip; hmm maybe #ca8e62?&rdquo; One hour later, still tweaking After Oklab:
&ldquo;Too bright? Change L from 0.68 to 0.65&rdquo; Done in 30 seconds The real win is systematic adjustments:
Make everything 5% brighter? Add 0.05 to all L values Reduce saturation? Scale down all a/b values by 20% Switch from data-first to structure-first? Just swap the L values You&rsquo;re not guessing anymore. You&rsquo;re tuning a system.
Some Practical Tips Testing colors quickly:
local test = oklab_to_srgb(0.68, 0.055, 0.065) print(test) -- prints: #c5895b Adjusting systematically:
-- Make everything 5% brighter colors.orange = oklab_to_srgb(0.73, 0.055, 0.065) -- was 0.68 -- Reduce saturation by 20% colors.orange = oklab_to_srgb(0.68, 0.044, 0.052) -- was (0.055, 0.065) -- Warm up the whole palette colors.orange = oklab_to_srgb(0.68, 0.055, 0.075) -- increase b value When not to use Oklab: If you&rsquo;re trying to match an existing hex code exactly, just use the hex. Oklab is for designing colors, not copying them.
References Oklab spec: https://bottosson.github.io/posts/oklab/ (this is where all those magic numbers come from) That&rsquo;s it. No need to make this more complicated than it is. Pick some L values for brightness, tweak a/b until the hues look right, and you&rsquo;re done.
`,url:"https://www.functor.me/posts/oklab_design/"},"https://www.functor.me/tags/":{title:"Tags",tags:[],content:"",url:"https://www.functor.me/tags/"},"https://www.functor.me/categories/":{title:"Categories",tags:[],content:"",url:"https://www.functor.me/categories/"}}</script></footer></body></html>